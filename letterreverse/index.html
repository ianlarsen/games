<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letter Reversals</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Lexend Deca is a font designed for readability, with a "ball and stick" a -->
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Link to shared stylesheet -->
    <link rel="stylesheet" href="../style/style.css">
    <style>
        /* Apply the kid-friendly font to the whole game */
        body { font-family: 'Lexend Deca', sans-serif; touch-action: manipulation; }
        .letter-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; }
        .letter-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(2rem, 10vw, 4rem);
            font-weight: bold;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            cursor: pointer;
            aspect-ratio: 1 / 1;
            transition: background-color 0.2s, transform 0.2s;
            user-select: none; /* Prevents text selection on rapid clicks */
        }
        .letter-cell:hover { background-color: #f3f4f6; }
        .letter-cell.correct { background-color: #d1fae5; border-color: #10b981; transform: scale(1.05); }
        .letter-cell.incorrect { background-color: #fee2e2; border-color: #ef4444; }
        
        /* Using the standardized game-shake for consistency */
        @keyframes gameShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        .game-shake {
            animation: gameShake 0.3s ease-in-out;
        }

        /* Win Overlay and Confetti */
        .win-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 1000; opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease-in-out;
        }
        .win-overlay.show { opacity: 1; pointer-events: auto; }
        .win-message { color: white; font-size: 3rem; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .confetti-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 1001;
        }
        .confetti {
            position: absolute; width: 10px; height: 10px;
            background-color: #f00; opacity: 0.8;
            animation: fall 5s linear forwards;
        }
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">

    <main class="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-lg p-4 sm:p-6 md:p-8">
        <header class="flex items-center justify-between gap-4 mb-6 pb-4 border-b">
             <h1 class="text-3xl font-bold text-gray-800">Letter Reversals</h1>
             <a href="../index.html" class="px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg shadow-sm hover:bg-gray-300 transition">&larr; Back to Games</a>
        </header>

        <div class="text-center mb-6">
            <h2 class="text-2xl font-semibold text-gray-700">Find all the letters that look like this:</h2>
            <div id="target-letter" class="text-8xl font-bold text-blue-600 my-4"></div>
        </div>

        <div id="letter-grid" class="letter-grid">
            <!-- Letter cells will be generated here -->
        </div>
    </main>

    <!-- Win Overlay -->
    <div id="win-overlay" class="win-overlay">
        <div class="win-message">You Won!</div>
        <div class="mt-8 flex flex-col sm:flex-row gap-4">
            <button id="continue-btn" class="px-8 py-4 bg-emerald-600 text-white font-bold text-lg rounded-lg shadow-md hover:bg-emerald-700 transition">Continue</button>
            <!-- Corrected link -->
            <a href="../index.html" class="px-8 py-4 bg-gray-200 text-gray-800 font-semibold text-lg rounded-lg shadow-sm hover:bg-gray-300 transition text-center">Back to Games</a>
        </div>
    </div>
    <div id="confetti-container" class="confetti-container"></div>

    <!-- Audio Elements -->
    <audio id="flip-sound" src="../sounds/flip.mp3" preload="auto"></audio>
    <audio id="win-sound" src="../sounds/win.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('letter-grid');
            const targetLetterEl = document.getElementById('target-letter');
            const mainEl = document.querySelector('main');
            const winOverlay = document.getElementById('win-overlay');
            const continueBtn = document.getElementById('continue-btn');
            const confettiContainer = document.getElementById('confetti-container');

            const flipSound = document.getElementById('flip-sound');
            const winSound = document.getElementById('win-sound');
            let audioUnlocked = false;

            const letterPairs = [
                { target: 'b', distractor: 'd' }, { target: 'd', distractor: 'b' },
                { target: 'p', distractor: 'q' }, { target: 'q', distractor: 'p' },
                { target: 'i', distractor: 'l' }, { target: 'l', distractor: 'i' },
                { target: 'a', distractor: 'e' }, { target: 'e', distractor: 'a' },
                { target: 'c', distractor: 'o' }, { target: 'o', distractor: 'c' },
                { target: 'm', distractor: 'n' }, { target: 'n', distractor: 'm' }
            ];
            
            let currentPair;
            let foundCount = 0;
            let totalTargets = 0;

            function unlockAudio() {
                if (audioUnlocked) return;
                flipSound.play().then(() => { flipSound.pause(); winSound.play().then(() => winSound.pause()).catch(() => {}); audioUnlocked = true; }).catch(() => {});
            }

            function playSound(sound) {
                if (sound && audioUnlocked) {
                    sound.currentTime = 0;
                    sound.play().catch(e => console.error("Sound play failed:", e));
                }
            }
            
            function triggerHapticFeedback() {
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
            }

            function initGame() {
                winOverlay.classList.remove('show');
                confettiContainer.innerHTML = '';
                grid.innerHTML = '';
                foundCount = 0;
                
                currentPair = letterPairs[Math.floor(Math.random() * letterPairs.length)];
                totalTargets = Math.floor(Math.random() * 5) + 8; // 8 to 12 targets

                targetLetterEl.textContent = currentPair.target;

                let letters = Array(totalTargets).fill(currentPair.target);
                letters = letters.concat(Array(25 - totalTargets).fill(currentPair.distractor));
                shuffle(letters);

                letters.forEach(letter => {
                    const cell = document.createElement('div');
                    cell.classList.add('letter-cell');
                    cell.textContent = letter;
                    cell.dataset.letter = letter;
                    cell.addEventListener('click', handleCellClick);
                    grid.appendChild(cell);
                });
            }

            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            function handleCellClick(event) {
                if (!audioUnlocked) unlockAudio();
                const cell = event.currentTarget;

                if (cell.classList.contains('correct') || cell.classList.contains('incorrect')) return;
                
                if (cell.dataset.letter === currentPair.target) {
                    playSound(flipSound);
Services
                    cell.classList.add('correct');
                    foundCount++;
                    
                    if (foundCount === totalTargets) {
                        playSound(winSound);
                        triggerConfetti();
                        setTimeout(() => winOverlay.classList.add('show'), 300);
                    }
                } else {
                    cell.classList.add('incorrect');
                    mainEl.classList.add('game-shake'); // Use game-shake
                    triggerHapticFeedback(); // Add haptics
                    setTimeout(() => {
                        mainEl.classList.remove('game-shake');
                        cell.classList.remove('incorrect');
                    }, 800);
                }
            }
            
            function triggerConfetti() {
                confettiContainer.innerHTML = '';
                const colors = ['#ff5733', '#33ff57', '#3357ff', '#ff33a1', '#a133ff', '#33fff6'];
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.classList.add('confetti');
                    confetti.style.left = `${Math.random() * 100}vw`;
                    confetti.style.top = `${Math.random() * -50}vh`;
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = `${Math.random() * 3 + 2}s`;
                    confettiContainer.appendChild(confetti);
                }
            }

            continueBtn.addEventListener('click', initGame);
            initGame();
        });
    </script>
</body>
</html>