<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letter Reversals</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Lexend Deca is a font designed for readability -->
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 
      FIX 1: 
      Removed the broken link to ../style/style.css and added the
      necessary styles directly into this <style> tag.
      I've also applied the 'Lexend Deca' font.
    -->
    <style>
        body {
            font-family: 'Lexend Deca', sans-serif;
        }

        .letter-grid {
            display: grid;
            grid-template-columns: repeat(5, minmax(0, 1fr));
            gap: 0.75rem; /* 12px */
        }

        @media (min-width: 640px) {
            .letter-grid {
                gap: 1rem; /* 16px */
            }
        }

        .letter-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.25rem; /* 36px */
            line-height: 2.5rem; /* 40px */
            font-weight: 700;
            aspect-ratio: 1 / 1;
            border: 2px solid #d1d5db; /* border-gray-300 */
            border-radius: 0.75rem; /* rounded-xl */
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            user-select: none; /* Prevents text selection on click */
        }

        .letter-cell:hover {
            background-color: #f3f4f6; /* bg-gray-100 */
        }

        .letter-cell.correct {
            background-color: #10b981; /* bg-emerald-500 */
            color: white;
            transform: scale(1.05);
            border-color: #059669; /* border-emerald-700 */
        }

        .letter-cell.incorrect {
            background-color: #ef4444; /* bg-red-500 */
            color: white;
            animation: shake 0.5s;
        }

        .win-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 50;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .win-overlay.show {
            display: flex;
            opacity: 1;
        }

        .win-message {
            font-size: 3rem; /* 48px */
            font-weight: 700;
            color: white;
            text-shadow: 0 0 15px rgba(0,0,0,0.5);
        }

        @media (min-width: 640px) {
            .win-message {
                font-size: 4.5rem; /* 72px */
            }
        }

        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0.9;
            animation: fall 4s linear forwards;
        }

        @keyframes fall {
            0% {
                transform: translateY(-20vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(110vh) rotate(720deg);
                opacity: 0;
            }
        }

        .game-shake {
            animation: shake 0.6s cubic-bezier(.36, .07, .19, .97);
        }

        @keyframes shake {
            10%, 90% { transform: translateX(-1px); }
            20%, 80% { transform: translateX(2px); }
            30%, 50%, 70% { transform: translateX(-4px); }
            40%, 60% { transform: translateX(4px); }
        }

    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">

    <main class="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-lg p-4 sm:p-6 md:p-8">
        <header class="flex items-center justify-between gap-4 mb-6 pb-4 border-b">
             <h1 class="text-3xl font-bold text-gray-800">Letter Reversals</h1>
             <!-- This link goes up one directory. It may not work in this preview, but is structurally correct. -->
             <a href="../index.html" class="px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg shadow-sm hover:bg-gray-300 transition">&larr; Back to Games</a>
        </header>

        <div class="text-center mb-6">
            <h2 class="text-2xl font-semibold text-gray-700">Find all the letters that look like this:</h2>
            <div id="target-letter" class="text-8xl font-bold text-blue-600 my-4"></div>
        </div>

        <div id="letter-grid" class="letter-grid">
            <!-- Letter cells will be generated here -->
        </div>
    </main>

    <!-- Win Overlay -->
    <div id="win-overlay" class="win-overlay">
        <div class="win-message">You Won!</div>
        <div class="mt-8 flex flex-col sm:flex-row gap-4">
            <button id="continue-btn" class="px-8 py-4 bg-emerald-600 text-white font-bold text-lg rounded-lg shadow-md hover:bg-emerald-700 transition">Continue</button>
            <a href="../index.html" class="px-8 py-4 bg-gray-200 text-gray-800 font-semibold text-lg rounded-lg shadow-sm hover:bg-gray-300 transition text-center">Back to Games</a>
        </div>
    </div>
    <div id="confetti-container" class="confetti-container"></div>

    <!-- 
      FIX 2: 
      Audio tags removed. The relative paths '../sounds/flip.mp3' 
      and '../sounds/win.mp3' will not work in a self-contained HTML file 
      unless those files are hosted somewhere and linked via a full URL.
    -->
    <!-- <audio id="flip-sound" src="../sounds/flip.mp3" preload="auto"></audio> -->
    <!-- <audio id="win-sound" src="../sounds/win.mp3" preload="auto"></audio> -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('letter-grid');
            const targetLetterEl = document.getElementById('target-letter');
            const mainEl = document.querySelector('main');
            const winOverlay = document.getElementById('win-overlay');
            const continueBtn = document.getElementById('continue-btn');
            const confettiContainer = document.getElementById('confetti-container');

            // FIX 2 (continued): Sound elements are commented out.
            // const flipSound = document.getElementById('flip-sound');
            // const winSound = document.getElementById('win-sound');
            let audioUnlocked = false; // We can leave this logic, it won't break anything.

            const letterPairs = [
                { target: 'b', distractor: 'd' }, { target: 'd', distractor: 'b' },
                { target: 'p', distractor: 'q' }, { target: 'q', distractor: 'p' },
                { target: 'i', distractor: 'l' }, { target: 'l', distractor: 'i' },
                { target: 'a', distractor: 'e' }, { target: 'e', distractor: 'a' },
                { target: 'c', distractor: 'o' }, { target: 'o', distractor: 'c' },
                { target: 'm', distractor: 'n' }, { target: 'n', distractor: 'm' }
            ];
            
            let currentPair;
            let foundCount = 0;
            let totalTargets = 0;

            function unlockAudio() {
                if (audioUnlocked) return;
                // FIX 2 (continued): Audio play attempts removed.
                // flipSound.play().then(() => { flipSound.pause(); winSound.play().then(() => winSound.pause()).catch(() => {}); audioUnlocked = true; }).catch(() => {});
                audioUnlocked = true; // Set to true anyway.
            }

            function playSound(sound) {
                // FIX 2 (continued): Function body commented out.
                /*
                if (sound && audioUnlocked) {
                    sound.currentTime = 0;
                    sound.play().catch(e => console.error("Sound play failed:", e));
                }
                */
            }
            
            function triggerHapticFeedback() {
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
            }

            function initGame() {
                winOverlay.classList.remove('show');
                confettiContainer.innerHTML = '';
                grid.innerHTML = '';
                foundCount = 0;
                
                currentPair = letterPairs[Math.floor(Math.random() * letterPairs.length)];
                totalTargets = Math.floor(Math.random() * 5) + 8; // 8 to 12 targets

                targetLetterEl.textContent = currentPair.target;

                let letters = Array(totalTargets).fill(currentPair.target);
                letters = letters.concat(Array(25 - totalTargets).fill(currentPair.distractor));
                shuffle(letters);

                letters.forEach(letter => {
                    const cell = document.createElement('div');
                    cell.classList.add('letter-cell');
                    cell.textContent = letter;
                    cell.dataset.letter = letter;
                    cell.addEventListener('click', handleCellClick);
                    grid.appendChild(cell);
                });
            }

            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            function handleCellClick(event) {
                if (!audioUnlocked) unlockAudio();
                const cell = event.currentTarget;

                if (cell.classList.contains('correct') || cell.classList.contains('incorrect')) return;
                
                if (cell.dataset.letter === currentPair.target) {
                    // playSound(flipSound); // Sound call commented out
                    
                    /*
                      FIX 3 (CRITICAL): 
                      Removed the stray word "Services" which was here.
                      It was a syntax error and would break the script.
                    */
                    cell.classList.add('correct');
                    foundCount++;
                    
                    if (foundCount === totalTargets) {
                        // playSound(winSound); // Sound call commented out
                        triggerConfetti();
                        setTimeout(() => winOverlay.classList.add('show'), 300);
                    }
                } else {
                    cell.classList.add('incorrect');
                    mainEl.classList.add('game-shake');
                    triggerHapticFeedback();
                    setTimeout(() => {
                        mainEl.classList.remove('game-shake');
                        cell.classList.remove('incorrect');
                    }, 800);
                }
            }
            
            function triggerConfetti() {
                confettiContainer.innerHTML = '';
                const colors = ['#ff5733', '#33ff57', '#3357ff', '#ff33a1', '#a133ff', '#33fff6'];
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.classList.add('confetti');
                    confetti.style.left = `${Math.random() * 100}vw`;
                    confetti.style.top = `${Math.random() * -50}vh`;
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = `${Math.random() * 3 + 2}s`;
                    confettiContainer.appendChild(confetti);
                }
            }

            continueBtn.addEventListener('click', initGame);
            initGame();
        });
    </script>
</body>
</html>
