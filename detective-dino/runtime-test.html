<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detective Dino - Runtime Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 20px; }
        #console-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .summary {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ðŸ¦• Detective Dino - Runtime Test</h1>
        <p>This page tests the game's JavaScript execution and functionality.</p>

        <div id="test-results"></div>
        <div class="summary" id="summary"></div>

        <h2>Console Output</h2>
        <div id="console-output"></div>
    </div>

    <!-- Load game scripts -->
    <script src="mysteries.js"></script>
    <script src="audio.js"></script>
    <script src="game.js"></script>

    <!-- Test script -->
    <script>
        const resultsDiv = document.getElementById('test-results');
        const consoleDiv = document.getElementById('console-output');
        const summaryDiv = document.getElementById('summary');
        let passCount = 0;
        let failCount = 0;

        // Capture console output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            consoleDiv.innerHTML += `<div style="color: #0f0;">[LOG] ${args.join(' ')}</div>`;
            originalLog.apply(console, args);
        };

        console.error = function(...args) {
            consoleDiv.innerHTML += `<div style="color: #f00;">[ERROR] ${args.join(' ')}</div>`;
            originalError.apply(console, args);
        };

        console.warn = function(...args) {
            consoleDiv.innerHTML += `<div style="color: #ff0;">[WARN] ${args.join(' ')}</div>`;
            originalWarn.apply(console, args);
        };

        function addTest(name, passed, message = '') {
            const div = document.createElement('div');
            div.className = `test-result ${passed ? 'pass' : 'fail'}`;
            div.innerHTML = `<strong>${passed ? 'âœ“ PASS' : 'âœ— FAIL'}:</strong> ${name}${message ? ' - ' + message : ''}`;
            resultsDiv.appendChild(div);

            if (passed) passCount++;
            else failCount++;
        }

        function addInfo(message) {
            const div = document.createElement('div');
            div.className = 'test-result info';
            div.innerHTML = `<strong>â„¹ INFO:</strong> ${message}`;
            resultsDiv.appendChild(div);
        }

        // Run tests
        addInfo('Starting runtime tests...');

        // Test 1: mysteriesData exists
        try {
            const test1 = typeof mysteriesData !== 'undefined';
            addTest('mysteriesData object exists', test1);

            if (test1) {
                // Test 1a: mysteriesData has missing_cookies
                const hasMissingCookies = mysteriesData.hasOwnProperty('missing_cookies');
                addTest('mysteriesData.missing_cookies exists', hasMissingCookies);

                if (hasMissingCookies) {
                    // Test 1b: mystery has suspects
                    const mystery = mysteriesData.missing_cookies;
                    const hasSuspects = mystery.hasOwnProperty('suspects');
                    addTest('Mystery has suspects', hasSuspects);

                    if (hasSuspects) {
                        // Test 1c: All 4 suspects exist
                        const suspects = ['bunny', 'cat', 'dog', 'mouse'];
                        suspects.forEach(suspect => {
                            const exists = mystery.suspects.hasOwnProperty(suspect);
                            addTest(`Suspect '${suspect}' exists`, exists);

                            if (exists) {
                                // Test suspect has clues
                                const hasClues = mystery.suspects[suspect].hasOwnProperty('clues');
                                addTest(`${suspect} has clues`, hasClues);

                                // Test suspect has dialogue
                                const hasDialogue = mystery.suspects[suspect].hasOwnProperty('dialogue');
                                addTest(`${suspect} has dialogue`, hasDialogue);
                            }
                        });
                    }
                }
            }
        } catch (err) {
            addTest('mysteriesData tests', false, err.message);
        }

        // Test 2: AudioManager exists
        try {
            const test2 = typeof AudioManager !== 'undefined';
            addTest('AudioManager object exists', test2);

            if (test2) {
                const hasMethods = ['playClick', 'playClueFound', 'playCorrect', 'playWrong'].every(
                    method => typeof AudioManager[method] === 'function'
                );
                addTest('AudioManager has required methods', hasMethods);
            }
        } catch (err) {
            addTest('AudioManager tests', false, err.message);
        }

        // Test 3: Game object exists
        try {
            const test3 = typeof Game !== 'undefined';
            addTest('Game object exists', test3);

            if (test3) {
                // Test Game has required methods
                const requiredMethods = [
                    'init',
                    'selectRandomMystery',
                    'renderLocation',
                    'renderCharacter',
                    'interactWithCharacter',
                    'accuseSuspect'
                ];

                requiredMethods.forEach(method => {
                    const exists = typeof Game[method] === 'function';
                    addTest(`Game.${method}() exists`, exists);
                });

                // Test Game has required properties
                const requiredProps = ['currentLocation', 'cluesFound', 'guiltySuspect'];
                requiredProps.forEach(prop => {
                    const exists = Game.hasOwnProperty(prop);
                    addTest(`Game.${prop} exists`, exists);
                });
            }
        } catch (err) {
            addTest('Game object tests', false, err.message);
        }

        // Test 4: Mystery selection simulation
        try {
            addInfo('Attempting to simulate mystery selection...');

            // Simulate selectRandomMystery
            const mysteryKeys = Object.keys(mysteriesData);
            const randomMystery = mysteryKeys[0]; // Use first mystery for testing
            const testMystery = mysteriesData[randomMystery];

            addTest('Can access mystery data', testMystery !== undefined);

            if (testMystery && testMystery.suspects) {
                const suspectKeys = Object.keys(testMystery.suspects);
                const testSuspect = suspectKeys[0];
                const suspectData = testMystery.suspects[testSuspect];

                addTest('Can access suspect data', suspectData !== undefined);

                if (suspectData && suspectData.clues) {
                    const clueKeys = Object.keys(suspectData.clues);
                    addTest(`Suspect has ${clueKeys.length} clues`, clueKeys.length === 4);
                }
            }
        } catch (err) {
            addTest('Mystery selection simulation', false, err.message);
        }

        // Summary
        const total = passCount + failCount;
        const passRate = total > 0 ? ((passCount / total) * 100).toFixed(1) : 0;

        if (failCount === 0) {
            summaryDiv.className = 'summary pass';
            summaryDiv.innerHTML = `âœ“ ALL TESTS PASSED! (${passCount}/${total}) - ${passRate}%`;
        } else {
            summaryDiv.className = 'summary fail';
            summaryDiv.innerHTML = `âœ— SOME TESTS FAILED: ${passCount} passed, ${failCount} failed (${passRate}% pass rate)`;
        }

        console.log(`\n=== Test Complete ===`);
        console.log(`Passed: ${passCount}`);
        console.log(`Failed: ${failCount}`);
        console.log(`Pass Rate: ${passRate}%`);
    </script>
</body>
</html>
