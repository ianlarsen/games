<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dead Trail</title>
  <link rel="icon" href="favicon.ico" />
  <style>
    body {
      background: #0f0f12;
      color: #f0f3f8;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      margin: 0; padding: 0;
    }
    #game {
      max-width: 960px;
      margin: 24px auto;
      background: #14161b;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    .hud {
      background: #1a1b20;
      padding: 8px 12px;
      font-weight: bold;
      border-radius: 6px;
      margin-bottom: 12px;
    }
    .media {
      background: #2a2c34;
      width: 100%;
      max-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      margin-bottom: 16px;
    }
    .media img {
      max-width: 100%;
      border-radius: 6px;
    }
    .dialogue {
      margin-bottom: 12px;
      line-height: 1.5;
    }
    .choices button {
      display: block;
      background: #1f222a;
      color: #e2e8f0;
      border: 1px solid #2c313d;
      border-radius: 6px;
      padding: 8px 14px;
      margin: 6px 0;
      cursor: pointer;
      text-align: left;
      width: fit-content;
      transition: background 0.2s;
    }
    .choices button:hover {
      background: #2c313d;
    }
    .center {
      text-align: center;
      margin-top: 24px;
    }
  </style>
</head>
<body>
  <div id="game">
    <div class="hud" id="hud">Trust: 0</div>
    <div class="media" id="media"></div>
    <div class="dialogue" id="dialogue"></div>
    <div class="choices" id="choices"></div>
  </div>

  <script>
    // ------------------ Core Game State ------------------
    const state = { trust: 0, current: 0 };

    const events = [
      {
        prompt: "A Roomba thunks the same wall. Microwave dings somewhere.",
        speaker: "Ed",
        line: "At least the Roombas don’t eat people.",
        image: "images/events/RoombaGag.png", // if missing, placeholder shows
        choices: [
          { label: "Let Ed tinker", effects: { trust: +1 } },
          { label: "Ignore it", effects: { trust: -1 } },
        ],
      },
      {
        prompt: "You catch a glint—Jamaal signalling toward the treeline.",
        speaker: "John",
        line: "We can argue about titles, or we can survive.",
        image: "images/portraits/John.png", // if missing, placeholder shows
        choices: [
          { label: "Confront Jamaal", effects: { trust: -1 } },
          { label: "Watch quietly", effects: { trust: +1 } },
        ],
      },
    ];

    // ------------------ Placeholder Maker ------------------
    function makePlaceholder(label, w, h) {
      const canvas = document.createElement("canvas");
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext("2d");
      ctx.fillStyle = "#2a2c34"; ctx.fillRect(0,0,w,h);
      ctx.strokeStyle = "#1b1d24"; ctx.lineWidth = 2;
      for (let i=-h;i<w;i+=16) {
        ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i+h,h); ctx.stroke();
      }
      ctx.strokeStyle = "#4a5568"; ctx.lineWidth = 4;
      ctx.strokeRect(2,2,w-4,h-4);
      ctx.fillStyle = "#e2e8f0";
      ctx.font = `bold ${Math.max(14, Math.floor(w*0.05))}px system-ui,Segoe UI,Roboto`;
      ctx.textAlign = "center"; ctx.textBaseline = "middle";
      ctx.fillText(label || "Event", w/2, h/2);
      return canvas.toDataURL("image/png");
    }

    // ------------------ Render Functions ------------------
    function renderHUD() {
      document.getElementById("hud").textContent = `Trust: ${state.trust}`;
    }

    function renderEvent(event) {
      const media = document.getElementById("media");
      const dialogue = document.getElementById("dialogue");
      const choices = document.getElementById("choices");

      media.innerHTML = "";
      dialogue.innerHTML = "";
      choices.innerHTML = "";

      // Render image or placeholder
      const img = document.createElement("img");
      img.width = 800;
      img.height = 360;
      const imageSrc = event.image && event.image.trim() ? event.image : "";
      img.src = imageSrc || makePlaceholder("Event", 800, 360);
      img.onerror = () => {
        img.onerror = null;
        img.src = makePlaceholder("Event", 800, 360);
      };
      media.appendChild(img);

      // Dialogue
      const text = document.createElement("div");
      text.innerHTML = `<p>${event.prompt}</p><p><strong>${event.speaker}:</strong> “${event.line}”</p>`;
      dialogue.appendChild(text);

      // Choices
      event.choices.forEach((ch) => {
        const btn = document.createElement("button");
        btn.textContent = ch.label;
        btn.onclick = () => {
          if (ch.effects && typeof ch.effects.trust === "number") {
            state.trust += ch.effects.trust;
          }
          state.current++;
          if (state.current >= events.length) {
            endGame();
          } else {
            renderHUD();
            renderEvent(events[state.current]);
          }
        };
        choices.appendChild(btn);
      });
    }

    function endGame() {
      const media = document.getElementById("media");
      const dialogue = document.getElementById("dialogue");
      const choices = document.getElementById("choices");
      media.innerHTML = "";
      dialogue.innerHTML = `<div class="center"><h2>The journey continues…</h2></div>`;
      choices.innerHTML = `<div class="center"><button onclick="restart()">Restart</button></div>`;
    }

    function restart() {
      state.trust = 0;
      state.current = 0;
      renderHUD();
      renderEvent(events[0]);
    }

    // ------------------ Start Game ------------------
    renderHUD();
    renderEvent(events[0]);
  </script>
</body>
</html>
