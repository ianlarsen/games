<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J.A.M.A.A.L. - An Interactive Story</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #1a1a1a;
            color: #f0f0f0;
            overflow: hidden;
        }
        #game-container {
            width: 100%;
            max-width: 1024px;
            aspect-ratio: 16 / 9;
            position: relative;
            border: 4px solid #4a4a4a;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #scene {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            position: relative;
            border-radius: 4px;
        }
        .character, .object {
            position: absolute;
            cursor: pointer;
            transition: transform 0.2s ease-in-out, filter 0.2s ease-in-out;
            image-rendering: pixelated; /* Ensures pixel art doesn't blur */
        }
        .character:hover, .object:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 0 8px #ffffff);
        }
        #dialogue-box {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            border: 3px solid #4a4a4a;
            border-radius: 8px;
            padding: 20px;
            display: none; /* Hidden by default */
            font-size: 14px;
            line-height: 1.5;
        }
        #choices-box {
            margin-top: 15px;
        }
        .choice-btn {
            background-color: #333;
            border: 2px solid #555;
            color: #fff;
            padding: 10px 15px;
            margin-right: 10px;
            margin-top: 10px;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
        }
        .choice-btn:hover {
            background-color: #555;
            border-color: #777;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center h-screen p-4">

    <div id="game-container">
        <!-- The scene background will be set here -->
        <div id="scene">
            <!-- Characters and objects will be added here by JavaScript -->
        </div>

        <!-- Dialogue box for text and choices -->
        <div id="dialogue-box">
            <p id="dialogue-text"></p>
            <div id="choices-box">
                <!-- Buttons for choices will be added here -->
            </div>
        </div>
    </div>

    <script>
        // This constant now points to a local "images" folder.
        // Make sure your index.html file and your "images" folder are in the same directory.
        const ASSET_BASE_PATH = 'images/';

        const assets = {
            // Characters
            'john': ASSET_BASE_PATH + 'john.png',
            'jamaal': ASSET_BASE_PATH + 'jamaal.png',
            'dave': ASSET_BASE_PATH + 'dave.png',
            'zombie1': ASSET_BASE_PATH + 'zombie1.png',
            'rick': ASSET_BASE_PATH + 'rick.png',
            'daryl': ASSET_BASE_PATH + 'daryl.png',
            'carol': ASSET_BASE_PATH + 'carol.png',
            
            // Scenery
            'abandoned_office': ASSET_BASE_PATH + 'abandoned_office.png',
            'woods': ASSET_BASE_PATH + 'woods.png',
            'prison_exterior': ASSET_BASE_PATH + 'prison_exterior.png',
            'prison_interior': ASSET_BASE_PATH + 'prison_interior.png',

            // Objects
            'filing_cabinet': ASSET_BASE_PATH + 'filing_cabinet.png',
            'microwave': ASSET_BASE_PATH + 'microwave.png'
        };

        // This object holds the entire story structure.
        const storyData = {
            'office_start': {
                background: assets.abandoned_office,
                characters: [
                    { id: 'john', asset: assets.john, bottom: '10%', left: '30%', width: '10%' },
                    { id: 'jamaal', asset: assets.jamaal, bottom: '10%', left: '55%', width: '12%' },
                ],
                objects: [
                    { id: 'filing_cabinet', asset: assets.filing_cabinet, bottom: '10%', left: '5%', width: '10%' },
                    { id: 'microwave_obj', asset: assets.microwave, bottom: '18%', left: '80%', width: '12%' }
                ],
                onLoad: {
                    type: 'dialogue',
                    text: "The office is thick with the stench of decay. The flickering lights cast long, distorted shadows. We need to find supplies, fast.",
                    choices: [
                        { text: "Okay, let's search.", target: null } // null target just closes the box
                    ]
                },
                interactions: {
                    'john': {
                        type: 'dialogue',
                        text: "John: Stay sharp. We don't know what's in here. Check everything.",
                        choices: [
                            { text: "Right.", target: null }
                        ]
                    },
                    'jamaal': {
                        type: 'dialogue',
                        text: "Jamaal: Keep your eyes peeled. I'm not trying to become zombie-chow today. Maybe we can find some hand sanitizer to sell.",
                        choices: [
                            { text: "Stay focused.", target: null }
                        ]
                    },
                    'filing_cabinet': {
                        type: 'dialogue',
                        text: "It's a dusty, old filing cabinet. It looks like it's already been picked clean.",
                        choices: [
                            { text: "Leave it.", target: null }
                        ]
                    },
                    'microwave_obj': {
                        type: 'dialogue',
                        text: "A grimy microwave. Someone left something in here a long, long time ago. The smell is... memorable. Reminds you of Rob C.'s fish.",
                        choices: [
                            { text: "Step away. Slowly.", target: null },
                            { text: "A new beginning!", target: 'zombie_surprise' }
                        ]
                    }
                }
            },
            'zombie_surprise': {
                background: assets.abandoned_office,
                characters: [
                     { id: 'john', asset: assets.john, bottom: '10%', left: '30%', width: '10%' },
                     { id: 'jamaal', asset: assets.jamaal, bottom: '10%', left: '55%', width: '12%' },
                     { id: 'zombie1', asset: assets.zombie1, bottom: '10%', left: '75%', width: '10%' }
                ],
                objects: [
                     { id: 'filing_cabinet', asset: assets.filing_cabinet, bottom: '10%', left: '5%', width: '10%' }
                ],
                 onLoad: {
                    type: 'dialogue',
                    text: "As you reach for the microwave, a decaying corpse that was propped against a desk lurches towards you!",
                    choices: [
                        { text: "Fight!", target: 'game_over_fight' },
                        { text: "Run for the service tunnel!", target: 'forest_escape' }
                    ]
                },
                interactions: {
                    'john': {
                        type: 'dialogue',
                        text: "John: No time to talk, let's move!",
                        choices: [{ text: "Go!", target: null }]
                    },
                    'jamaal': {
                        type: 'dialogue',
                        text: "Jamaal: I told you this was a bad idea! My entrepreneurial spirit does not extend to being eaten!",
                        choices: [{ text: "Let's go!", target: null }]
                    },
                    'zombie1': {
                        type: 'dialogue',
                        text: "The zombie groans, its empty eyes fixed on you. It smells awful.",
                        choices: [{ text: "Back away.", target: null }]
                    }
                }
            },
            'forest_escape': {
                background: assets.woods,
                characters: [
                    { id: 'john', asset: assets.john, bottom: '15%', left: '40%', width: '12%' },
                    { id: 'jamaal', asset: assets.jamaal, bottom: '10%', left: '60%', width: '14%' },
                ],
                objects: [],
                onLoad: {
                    type: 'dialogue',
                    text: "You make a daring escape through a narrow service tunnel, emerging into a dense forest. Exhausted and low on supplies, you stumble upon a high chain-link fence...",
                    choices: [
                        { text: "A prison?", target: null }
                    ]
                },
                interactions: {
                    'john': {
                        type: 'dialogue',
                        text: "John: That's... something. Looks secure, at least.",
                        choices: [{ text: "Let's approach carefully.", target: 'prison_approach' }]
                    }
                }
            },
            'prison_approach': {
                background: assets.prison_exterior,
                characters: [
                    { id: 'john', asset: assets.john, bottom: '5%', left: '25%', width: '10%' },
                    { id: 'jamaal', asset: assets.jamaal, bottom: '5%', left: '40%', width: '12%' },
                ],
                objects: [],
                onLoad: {
                    type: 'dialogue',
                    text: "A voice shouts from a guard tower: \"Hold it right there! State your business!\"",
                    choices: [
                        { text: '"We\'re survivors. Looking for shelter."', target: 'prison_standoff' }
                    ]
                },
                interactions: {
                     'john': {
                        type: 'dialogue',
                        text: "John: Easy now. Let's not make any sudden moves.",
                        choices: [{ text: "Right.", target: null }]
                    },
                    'jamaal': {
                        type: 'dialogue',
                        text: "Jamaal: Let John do the talking. I'll assess the... real estate.",
                        choices: [{ text: "Okay.", target: null }]
                    }
                }
            },
            'prison_standoff': {
                background: assets.prison_exterior,
                 characters: [
                    { id: 'john', asset: assets.john, bottom: '5%', left: '25%', width: '10%' },
                    { id: 'jamaal', asset: assets.jamaal, bottom: '5%', left: '40%', width: '12%' },
                ],
                objects: [],
                onLoad: {
                    type: 'dialogue',
                    text: "Another voice scoffs from the tower: \"Peace? Ain't seen much of that lately.\" After a long, tense moment, the first voice returns: \"Alright. Come on in. Slow and steady.\"",
                    choices: [
                        { text: "Enter the prison.", target: 'prison_interior_welcome' }
                    ]
                },
                interactions: {}
            },
            'prison_interior_welcome': {
                background: assets.prison_interior,
                characters: [
                    { id: 'rick', asset: assets.rick, bottom: '10%', left: '20%', width: '11%' },
                    { id: 'carol', asset: assets.carol, bottom: '10%', left: '35%', width: '10%' },
                    { id: 'john', asset: assets.john, bottom: '10%', left: '60%', width: '10%' },
                    { id: 'jamaal', asset: assets.jamaal, bottom: '10%', left: '75%', width: '12%' },
                ],
                objects: [],
                onLoad: {
                    type: 'dialogue',
                    text: "You step inside. The air is heavy with mistrust. Rick's group watches your every move.",
                    choices: [
                        { text: "This is tense.", target: null }
                    ]
                },
                interactions: {
                    'rick': {
                        type: 'dialogue',
                        text: "Rick: You can stay for now. We have rules. You follow them, you're welcome. You break them, you're out. Any questions?",
                        choices: [{ text: "Understood.", target: null }]
                    },
                     'carol': {
                        type: 'dialogue',
                        text: "Carol: Don't mind Rick, he's just cautious. We've all been through a lot. You all look hungry.",
                        choices: [{ text: "We are.", target: null }]
                    },
                     'john': {
                        type: 'dialogue',
                        text: "John: (to Jamaal) Let's not cause any trouble. These people are survivors, just like us.",
                        choices: [{ text: "Agreed.", target: null }]
                    },
                    'jamaal': {
                        type: 'dialogue',
                        text: "Jamaal: (Quietly) Look at these walls, John. The concrete work... a little bio-inspired reinforcement, and this place could be a fortress. A very marketable fortress.",
                        choices: [{ text: "Focus, Jamaal.", target: null }]
                    }
                }
            },
            'game_over_fight': {
                background: assets.abandoned_office,
                characters: [],
                objects: [],
                onLoad: {
                    type: 'dialogue',
                    text: "You tried to fight the zombie with your bare hands. It did not go well. You have died.",
                    choices: [
                        { text: "Start Over", target: 'office_start' }
                    ]
                },
                interactions: {}
            }
        };

        // This object keeps track of where the player is in the story.
        let gameState = {
            currentScene: 'office_start',
        };

        const sceneEl = document.getElementById('scene');
        const dialogueBoxEl = document.getElementById('dialogue-box');
        const dialogueTextEl = document.getElementById('dialogue-text');
        const choicesBoxEl = document.getElementById('choices-box');

        function renderScene() {
            const sceneData = storyData[gameState.currentScene];
            if (!sceneData) {
                console.error("Scene not found:", gameState.currentScene);
                return;
            }

            // 1. Clear previous scene
            sceneEl.innerHTML = '';

            // 2. Set background
            sceneEl.style.backgroundImage = `url('${sceneData.background}')`;

            // 3. Render characters
            sceneData.characters.forEach(char => {
                const charEl = document.createElement('img');
                charEl.src = char.asset;
                charEl.className = 'character';
                charEl.style.bottom = char.bottom;
                charEl.style.left = char.left;
                charEl.style.width = char.width;
                charEl.dataset.interactionId = char.id;
                sceneEl.appendChild(charEl);
            });

            // 4. Render objects
            sceneData.objects.forEach(obj => {
                const objEl = document.createElement('img');
                objEl.src = obj.asset;
                objEl.className = 'object';
                objEl.style.bottom = obj.bottom;
                objEl.style.left = obj.left;
                objEl.style.width = obj.width;
                objEl.dataset.interactionId = obj.id;
                sceneEl.appendChild(objEl);
            });
            
            // 5. Show initial dialogue for the scene if it exists
            if (sceneData.onLoad) {
                 showDialogue(sceneData.onLoad);
            }
        }

        /**
         * Render a dialogue window with text and optional choices.  The story
         * engine passes a `dialogueData` object that contains the text to
         * display and an array of choice definitions.  Each choice can have
         * a `text` property (the label on the button) and an optional
         * `target` property which, when selected, updates the current
         * scene and re-renders the game.  When `target` is null or
         * undefined the dialogue simply closes without changing the
         * scene.  Note that previously this function contained a typo
         * (`dialogeData`) which prevented the choices from being
         * processed, breaking the game.  This corrected version uses
         * `dialogueData` consistently.
         *
         * @param {Object} dialogueData
         */
        function showDialogue(dialogueData) {
            // Set the dialogue text
            dialogueTextEl.innerText = dialogueData.text;
            // Clear any existing choice buttons
            choicesBoxEl.innerHTML = '';

            // Render choice buttons if provided
            if (dialogueData.choices && dialogueData.choices.length > 0) {
                dialogueData.choices.forEach(choice => {
                    const btn = document.createElement('button');
                    btn.innerText = choice.text;
                    btn.className = 'choice-btn';
                    btn.onclick = () => {
                        // If a target is defined, transition to that scene
                        if (choice.target) {
                            gameState.currentScene = choice.target;
                            dialogueBoxEl.style.display = 'none';
                            renderScene();
                        } else {
                            // Otherwise just hide the dialogue box
                            dialogueBoxEl.style.display = 'none';
                        }
                    };
                    choicesBoxEl.appendChild(btn);
                });
            }

            // Show the dialogue box
            dialogueBoxEl.style.display = 'block';
        }

        // Event listener for clicks on characters or objects
        sceneEl.addEventListener('click', (e) => {
            const interactionId = e.target.dataset.interactionId;
            if (interactionId) {
                const sceneData = storyData[gameState.currentScene];
                const interaction = sceneData.interactions[interactionId];
                if (interaction) {
                    if (interaction.type === 'dialogue') {
                        showDialogue(interaction);
                    }
                }
            }
        });


        // Initial game setup
        window.onload = () => {
            renderScene();
        };

    </script>

</body>
</html>

