<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Left and Right Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Link to shared stylesheet -->
    <link rel="stylesheet" href="../style/style.css">
    <style>
        body { 
  height: auto;
  overflow-y: auto;
font-family: 'Inter', sans-serif; touch-action: manipulation; }
        
        select:invalid { color: #6b7280; } /* Gray color for placeholder */

        @keyframes gameShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        .game-shake {
            animation: gameShake 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">

    <main class="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-lg p-4 sm:p-6 md:p-8">
        <header class="flex flex-wrap items-center justify-start gap-4 mb-6 pb-4 border-b">
            <!-- Corrected back link to main index -->
            <a href="../index.html" class="px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg shadow-sm hover:bg-gray-300 transition">&larr; Back to Games</a>
        </header>

        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Which way is the animal facing?</h1>
        </div>

        <div id="image-container" class="w-full aspect-video bg-gray-100 rounded-lg flex items-center justify-center mb-8 overflow-hidden border">
            <img id="animal-image" src="" alt="An animal" class="max-w-full max-h-full object-contain">
        </div>

        <!-- New Dropdown UI -->
        <div class="w-full max-w-sm mx-auto">
             <label for="direction-select" class="block text-lg font-medium text-gray-700 text-center mb-2">Make your choice:</label>
            <select id="direction-select" class="block w-full text-center p-4 text-2xl font-semibold border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
                <option value="" selected disabled>Select...</option>
                <option value="left">Left</option>
                <option value="right">Right</option>
            </select>
        </div>
    </main>

    <!-- Audio Elements -->
    <!-- Added win.mp3 sound -->
    <audio id="win-sound" src="../sounds/win.mp3" preload="auto" playsinline></audio>
    <audio id="left-sound" src="../sounds/left.mp3" preload="auto" playsinline></audio>
    <audio id="right-sound" src="../sounds/right.mp3" preload="auto" playsinline></audio>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const animalImage = document.getElementById('animal-image');
            const directionSelect = document.getElementById('direction-select');
            const mainEl = document.querySelector('main');

            // --- Audio ---
            const winSound = document.getElementById('win-sound');
            const leftSound = document.getElementById('left-sound');
            const rightSound = document.getElementById('right-sound');
            let audioUnlocked = false;

            // --- Game Data ---
            const animals = [
                { src: 'images/horse_right.png', answer: 'right' }, { src: 'images/cow_left.png', answer: 'left' },
                { src: 'images/pig_left.png', answer: 'left' }, { src: 'images/frog_right.png', answer: 'right' },
                { src: 'images/turtle_left.png', answer: 'left' }, { src: 'images/goat_right.png', answer: 'right' },
                { src: 'images/dog_right.png', answer: 'right' }, { src: 'images/cat_left.png', answer: 'left' },
                { src: 'images/duck_left.png', answer: 'left' }, { src: 'images/chicken_right.png', answer: 'right' },
                { src: 'images/sheep_right.png', answer: 'right' }, { src: 'images/rooster_left.png', answer: 'left' },
                { src: 'images/bird_left.png', answer: 'left' }, { src: 'images/fish_right.png', answer: 'right' },
                { src: 'images/snake_right.png', answer: 'right' }, { src: 'images/lizard_left.png', answer: 'left' },
                { src: 'images/mouse_left.png', answer: 'left' }, { src: 'images/rabbit_right.png', answer: 'right' },
                { src: 'images/bear_right.png', answer: 'right' }, { src: 'images/fox_left.png', answer: 'left' },
            ];
            
            // --- Game State ---
            let shuffledAnimals = [];
            let currentAnimalIndex = 0;
            let processing = false; // Prevents multiple clicks while sounds are playing

            // --- Audio Functions ---
            function unlockAudio() {
                if (audioUnlocked) return;
                // Pre-play all sounds on a user gesture
                Promise.all([
                    leftSound.play(),
                    rightSound.play(),
                    winSound.play() // Added winSound
                ]).then(() => {
                    leftSound.pause();
                    rightSound.pause();
                    winSound.pause(); // Added winSound
                    audioUnlocked = true;
                }).catch(() => {});
            }

            function playSound(sound) {
                if (sound && audioUnlocked) {
                    sound.currentTime = 0;
                    sound.play().catch(e => console.error("Sound play failed:", e));
                }
            }

            // --- Haptic Feedback ---
            function triggerHapticFeedback() {
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
            }
            
            // --- Game Logic ---
            function initGame() {
                shuffledAnimals = [...animals].sort(() => Math.random() - 0.5);
                currentAnimalIndex = 0;
                loadAnimal();
            }

            function loadAnimal() {
                if (currentAnimalIndex >= shuffledAnimals.length) {
                    // Reshuffle and start over
                    shuffledAnimals.sort(() => Math.random() - 0.5);
                    currentAnimalIndex = 0;
                }
                const animal = shuffledAnimals[currentAnimalIndex];
                animalImage.src = animal.src;
                animalImage.onerror = () => animalImage.src = `https://placehold.co/400x225/e0e0e0/757575?text=${animal.src.split('/')[1]}`;
            }

            // --- UPDATED handleChoice function ---
            function handleChoice(event) {
                if (processing) return; // Exit if already processing a choice
                if (!audioUnlocked) unlockAudio();
                
                const selectedDirection = event.target.value;
                if (!selectedDirection) return; // Ignore if they re-select the "Select..." option

                processing = true; // Set processing flag
                const correctDirection = shuffledAnimals[currentAnimalIndex].answer;

                if (selectedDirection === correctDirection) {
                    // --- CORRECT ---
                    
                    // 1. Determine which sound to play first
                    const choiceSound = (selectedDirection === 'left') ? leftSound : rightSound;

                    // 2. Define what happens after the *first* sound finishes
                    const playWinSound = () => {
                        choiceSound.removeEventListener('ended', playWinSound); // Clean up listener
                        
                        // 3. Play the 'win' sound
                        playSound(winSound);

                        // 4. Define what happens after the 'win' sound finishes
                        const loadNext = () => {
                            winSound.removeEventListener('ended', loadNext); // Clean up listener

                            // 5. Load the next animal and reset state (with a tiny buffer)
                            setTimeout(() => {
                                currentAnimalIndex++;
                                loadAnimal();
                                directionSelect.value = ""; // Reset dropdown
                                processing = false; // Allow next choice
                            }, 150); // Small delay
                        };
                        winSound.addEventListener('ended', loadNext);
                    };
                    choiceSound.addEventListener('ended', playWinSound);

                    // 1a. Play the first (correct) sound
                    playSound(choiceSound);

                } else {
                    // --- INCORRECT ---
                    
                    // 1. Play the (wrong) choice sound
                    if (selectedDirection === 'left') {
                        playSound(leftSound);
                    } else if (selectedDirection === 'right') {
                        playSound(rightSound);
                    }
                    
                    mainEl.classList.add('game-shake');
                    triggerHapticFeedback();
                    
                    // 3. Reset after animation
                    setTimeout(() => {
                        mainEl.classList.remove('game-shake');
                        directionSelect.value = ""; // Reset dropdown
                        processing = false; // Allow next choice
                    }, 800);
                }
            }
            
            directionSelect.addEventListener('change', handleChoice);

            // Initial load
            initGame();
        });
    </script>
</body>
</html>
