<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Dot‑to‑Dot: Space Adventure</title>
  <style>
    /* =======================
       Global Layout & Theming
       ======================= */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    :root {
      /* The board is a perfect square that fits 80% of the viewport height,
         but never exceeds 95% of the viewport width. JS will override this
         with a pixel value for older/mobile browsers. */
      --board-size: min(80svh, 95vw);
    }

    body {
      margin: 0;
      background: #0c1445; /* Deep space blue */
      color: #f0f0f0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.3;
      -webkit-font-smoothing: antialiased;
    }

    .page {
      min-height: 100svh;
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: 12px;
      padding: clamp(8px, 2.5vw, 18px);
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .topbar h1 { font-size: clamp(18px, 3.8vw, 28px); margin: 0; }
    .topbar .status { display: inline-flex; gap: 10px; align-items: center; font-weight: 500; }
    #resetBtn {
      appearance: none;
      border: 1px solid #ddd;
      background: #2a3a8a;
      color: #fff;
      padding: 6px 10px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #resetBtn:hover {
        background-color: #3e4eb5;
    }

    /* =======================
       Board (square container)
       ======================= */
    .board-wrap {
      position: relative;
      margin: 0 auto;
      width: var(--board-size);
      height: var(--board-size); /* keep square */
      border: 2px solid #fff;
      border-radius: 16px;
      overflow: hidden;
      background: #0c1445;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    /* Completion image sits underneath and fades in on win */
    #completedImage {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      opacity: 0;
      transition: opacity 800ms ease;
      pointer-events: none;
    }
    #completedImage.revealed { opacity: 1; }

    /* SVG board fills container */
    #board { position: absolute; inset: 0; width: 100%; height: 100%; }
    #path {
      stroke: #fff;
      stroke-width: 6;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
    }

    /* Dots & labels */
    .dot .visual { fill: #fff; stroke: #fff; stroke-width: 0.5; transition: fill 0.2s; }
    .dot .hit { fill: transparent; pointer-events: all; cursor: pointer; }
    .dot.active .ring { stroke: #ffeb3b; stroke-width: 2.5; fill: none; r: 16; transition: r 0.3s ease-out; }
    .dot.active .visual { fill: #ffeb3b; }
    
    .dot text {
      font-size: 20px; /* SVG units; scales with viewBox */
      fill: #fff;
      paint-order: stroke;
      stroke: #0c1445;
      stroke-width: 4;
      font-weight: 700;
      -webkit-user-select: none; /* Safari */
      -ms-user-select: none; /* IE 10+ */
      user-select: none; 
    }
    .dot.active text {
        font-size: 24px;
        fill: #ffeb3b;
    }

    /* Feedback */
    .dot.wrong .visual { fill: #f44336; }
    @keyframes nudge {
      0% { transform: translateX(0); }
      25% { transform: translateX(-4px); }
      50% { transform: translateX(4px); }
      75% { transform: translateX(-3px); }
      100% { transform: translateX(0); }
    }
    .dot.wrong { animation: nudge 180ms ease; }

    .hint {
      text-align: center;
      font-size: clamp(12px, 2.8vw, 14px);
      color: #aaa;
    }
  </style>
</head>
<body>
  <main class="page">
    <header class="topbar">
      <h1>Dot‑to‑Dot: Space Adventure</h1>
      <div class="status">
        <span id="progress">1 / 115</span>
        <button id="resetBtn" aria-label="Reset level">Reset</button>
      </div>
    </header>

    <section class="board-wrap">
      <img id="completedImage" src="assets/images/rocket.jpg" alt="A cartoon rocket in space with an astronaut, planets, and a UFO." />
      <svg id="board" viewBox="0 0 1000 1000" role="img" aria-label="Dot to dot board">
        <defs>
          <filter id="halo" x="-50%" y="-50%" width="200%" height="200%">
            <feMorphology in="SourceAlpha" operator="dilate" radius="3" result="HALO" />
            <feGaussianBlur in="HALO" stdDeviation="2" result="BLUR" />
            <feMerge>
              <feMergeNode in="BLUR" />
              <feMergeNode in="SourceGraphic" />
            </feMerge>
          </filter>
        </defs>
        <polyline id="path" points="" />
        <g id="dots"></g>
      </svg>
    </section>

    <footer class="hint">Tap the dots in order: 1 → 115. When you're done, the full space scene will appear!</footer>
  </main>

  <script>
    /* Dot-to-Dot Space Adventure */

    const LEVEL = {
      imageSrc: "rocket.jpg",
      viewBox: [1000, 1000],
      dots: [
        // Rocket Body & Fins (1-55)
        { x: 500, y: 132 }, // 1 - Nose cone tip
        { x: 555, y: 195 }, // 2
        { x: 600, y: 270 }, // 3
        { x: 628, y: 355 }, // 4
        { x: 640, y: 440 }, // 5
        { x: 638, y: 530 }, // 6
        { x: 625, y: 610 }, // 7
        { x: 650, y: 625 }, // 8 - Right fin top
        { x: 710, y: 620 }, // 9
        { x: 700, y: 560 }, // 10
        { x: 650, y: 575 }, // 11
        { x: 610, y: 650 }, // 12 - Bottom of body
        { x: 580, y: 680 }, // 13
        { x: 540, y: 695 }, // 14
        { x: 460, y: 695 }, // 15
        { x: 420, y: 680 }, // 16
        { x: 390, y: 650 }, // 17
        { x: 350, y: 575 }, // 18 - Left fin bottom
        { x: 300, y: 560 }, // 19
        { x: 290, y: 620 }, // 20
        { x: 350, y: 625 }, // 21 - Left fin top
        { x: 375, y: 610 }, // 22
        { x: 362, y: 530 }, // 23
        { x: 360, y: 440 }, // 24
        { x: 372, y: 355 }, // 25
        { x: 400, y: 270 }, // 26
        { x: 445, y: 195 }, // 27
        { x: 500, y: 132 }, // 28
        { x: 545, y: 645 }, // 29 - Middle fin
        { x: 500, y: 615 }, // 30
        { x: 455, y: 645 }, // 31
        { x: 450, y: 710 }, // 32
        { x: 500, y: 740 }, // 33
        { x: 550, y: 710 }, // 34
        { x: 545, y: 645 }, // 35
        { x: 565, y: 240 }, // 36 - Window rivets
        { x: 590, y: 280 }, // 37
        { x: 605, y: 325 }, // 38
        { x: 610, y: 370 }, // 39
        { x: 605, y: 415 }, // 40
        { x: 435, y: 240 }, // 41
        { x: 410, y: 280 }, // 42
        { x: 395, y: 325 }, // 43
        { x: 390, y: 370 }, // 44
        { x: 395, y: 415 }, // 45
        { x: 420, y: 450 }, // 46 - Window pane
        { x: 460, y: 480 }, // 47
        { x: 500, y: 490 }, // 48
        { x: 540, y: 480 }, // 49
        { x: 580, y: 450 }, // 50
        { x: 595, y: 410 }, // 51
        { x: 590, y: 360 }, // 52
        { x: 570, y: 310 }, // 53
        { x: 530, y: 275 }, // 54
        { x: 470, y: 275 }, // 55
        // Astronaut in Window (56-65)
        { x: 470, y: 340 }, // 56 - Helmet
        { x: 530, y: 340 }, // 57
        { x: 545, y: 380 }, // 58
        { x: 520, y: 420 }, // 59
        { x: 480, y: 420 }, // 60
        { x: 455, y: 380 }, // 61
        { x: 525, y: 405 }, // 62 - Hand
        { x: 550, y: 380 }, // 63
        { x: 560, y: 420 }, // 64
        { x: 520, y: 435 }, // 65
        // Exhaust Flame (66-80)
        { x: 450, y: 700 }, // 66 - Top of flame
        { x: 550, y: 700 }, // 67
        { x: 580, y: 750 }, // 68
        { x: 590, y: 800 }, // 69
        { x: 570, y: 850 }, // 70
        { x: 520, y: 900 }, // 71
        { x: 480, y: 900 }, // 72
        { x: 430, y: 850 }, // 73
        { x: 410, y: 800 }, // 74
        { x: 420, y: 750 }, // 75
        { x: 450, y: 700 }, // 76
        { x: 470, y: 750 }, // 77 - Inner flame
        { x: 530, y: 750 }, // 78
        { x: 540, y: 800 }, // 79
        { x: 500, y: 850 }, // 80
        // Moon (81-90)
        { x: 195, y: 240 }, // 81 - Top of crescent
        { x: 250, y: 290 }, // 82
        { x: 280, y: 350 }, // 83
        { x: 280, y: 410 }, // 84
        { x: 250, y: 460 }, // 85
        { x: 195, y: 490 }, // 86 - Bottom of crescent
        { x: 210, y: 440 }, // 87
        { x: 220, y: 380 }, // 88
        { x: 220, y: 320 }, // 89
        { x: 210, y: 270 }, // 90
        // Saturn (91-105)
        { x: 745, y: 490 }, // 91 - Left of ring
        { x: 800, y: 470 }, // 92
        { x: 860, y: 465 }, // 93
        { x: 920, y: 475 }, // 94
        { x: 960, y: 495 }, // 95 - Right of ring
        { x: 910, y: 520 }, // 96
        { x: 860, y: 530 }, // 97
        { x: 800, y: 525 }, // 98
        { x: 745, y: 490 }, // 99
        { x: 810, y: 490 }, // 100 - Planet
        { x: 840, y: 515 }, // 101
        { x: 880, y: 510 }, // 102
        { x: 900, y: 480 }, // 103
        { x: 870, y: 460 }, // 104
        { x: 830, y: 465 }, // 105
        // UFO (106-115)
        { x: 750, y: 830 }, // 106 - Left side
        { x: 800, y: 810 }, // 107
        { x: 850, y: 810 }, // 108
        { x: 900, y: 830 }, // 109 - Right side
        { x: 870, y: 845 }, // 110
        { x: 830, y: 855 }, // 111
        { x: 770, y: 845 }, // 112
        { x: 750, y: 830 }, // 113
        { x: 790, y: 825 }, // 114 - Dome
        { x: 850, y: 825 }, // 115
      ],
    };

    let state = {
      expected: 1,
      points: [],
      poly: null,
      audioCtx: null,
      started: false,
      finished: false,
    };

    document.addEventListener("DOMContentLoaded", init);

    function init() {
      const svg = document.getElementById("board");
      svg.setAttribute("viewBox", "0 0 1000 1000");
      setBoardTo80vh();
      window.addEventListener("resize", setBoardTo80vh);
      window.addEventListener("orientationchange", setBoardTo80vh);

      const path = document.getElementById("path");
      state.poly = path;
      updateProgress();

      renderDots();
      setActiveDot(1);

      document.getElementById("resetBtn").addEventListener("click", resetGame, { passive: true });
    }

    function renderDots() {
      const dotsGroup = document.getElementById("dots");
      while (dotsGroup.firstChild) dotsGroup.removeChild(dotsGroup.firstChild);
      
      LEVEL.dots.forEach((pt, i) => {
        const g = el("g", { class: "dot", "data-index": i + 1 });
        const ring = el("circle", { class: "ring", cx: pt.x, cy: pt.y, r: 0 });
        const visual = el("circle", { class: "visual", cx: pt.x, cy: pt.y, r: 7 });
        const hit = el("circle", { class: "hit", cx: pt.x, cy: pt.y, r: 25 });
        
        let labelX = pt.x;
        let labelY = pt.y - 22; // Default above
        let anchor = "middle";

        if (pt.y < 50) labelY = pt.y + 26; // If near top, move below
        if (pt.x > 950) { labelX = pt.x - 20; anchor = "end"; } // If near right, move left
        if (pt.x < 50) { labelX = pt.x + 20; anchor = "start"; } // If near left, move right

        const label = el("text", { x: labelX, y: labelY, "text-anchor": anchor, "dominant-baseline": "central" });
        label.textContent = i + 1;
        
        g.appendChild(ring);
        g.appendChild(visual);
        g.appendChild(hit);
        g.appendChild(label);
        dotsGroup.appendChild(g);
        
        g.addEventListener("pointerdown", onDotPointer);
      });
    }

    function onDotPointer(e) {
      e.preventDefault();
      const g = e.currentTarget;
      const index = Number(g.getAttribute("data-index"));
      ensureAudio();

      if (state.finished) return;

      if (index === state.expected) {
        goodTap(index);
      } else {
        badTap(g);
      }
    }

    function goodTap(index) {
      const pt = LEVEL.dots[index - 1];
      const dotElement = document.querySelector(`.dot[data-index="${index}"]`);
      if(dotElement) {
        dotElement.style.visibility = 'hidden';
      }

      if (!state.started) {
        state.started = true;
        state.points = [`${pt.x},${pt.y}`];
      } else {
        // If there's a jump in dot sequence, start a new polyline
        const lastDotInfo = LEVEL.dots[index - 2];
        const currentDotInfo = LEVEL.dots[index - 1];
        
        const jumpSequences = [28, 35, 55, 65, 80, 90, 105];
        if (jumpSequences.includes(index-1)) {
            state.points.push(`${pt.x},${pt.y}`);
            const newPoly = el("polyline", {
                id: `path-${index}`,
                points: state.points.join(" "),
            });
            document.getElementById('board').insertBefore(newPoly, state.poly);
            state.points = [];
        } else {
            if (state.points.length === 0) {
                 const prevPt = LEVEL.dots[index-2];
                 state.points.push(`${prevPt.x},${prevPt.y}`);
            }
            state.points.push(`${pt.x},${pt.y}`);
            state.poly.setAttribute("points", state.points.join(" "));
        }
      }

      ding();

      state.expected++;
      updateProgress();

      clearActiveDot();
      if (state.expected <= LEVEL.dots.length) {
        setActiveDot(state.expected);
      } else {
        win();
      }
    }
    
    function badTap(g) {
      buzz();
      if ("vibrate" in navigator) navigator.vibrate(25);
      g.classList.add("wrong");
      setTimeout(() => g.classList.remove("wrong"), 200);
    }

    function win() {
      state.finished = true;
      chime();
      document.getElementById("completedImage").classList.add("revealed");
    }

    function resetGame() {
       // Remove added polylines
      document.querySelectorAll('polyline').forEach(p => {
          if(p.id !== 'path') p.remove();
      });
      state = { 
        expected: 1, 
        points: [], 
        poly: document.getElementById('path'), 
        audioCtx: state.audioCtx, 
        started: false, 
        finished: false 
      };
      state.poly.setAttribute("points", "");
      document.getElementById("completedImage").classList.remove("revealed");
      document.querySelectorAll(".dot").forEach((g) => {
          g.classList.remove("wrong", "active");
          g.style.visibility = 'visible';
      });
      setActiveDot(1);
      updateProgress();
    }


    function ensureAudio() {
      if (!state.audioCtx) {
        try {
          state.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        } catch(e) {
          console.error("Web Audio API is not supported in this browser.");
        }
      }
    }

    function tone({ freq = 440, type = "sine", duration = 0.1, gain = 0.06, when = 0 }) {
      if (!state.audioCtx) return;
      const ctx = state.audioCtx;
      const t0 = ctx.currentTime + when;
      const osc = ctx.createOscillator();
      const amp = ctx.createGain();
      osc.type = type;
      osc.frequency.setValueAtTime(freq, t0);
      amp.gain.setValueAtTime(gain, t0);
      amp.gain.exponentialRampToValueAtTime(0.0001, t0 + duration);
      osc.connect(amp).connect(ctx.destination);
      osc.start(t0);
      osc.stop(t0 + duration + 0.02);
    }

    function ding() {
      tone({ freq: 880, duration: 0.07, gain: 0.055 });
      tone({ freq: 1320, duration: 0.09, gain: 0.05, when: 0.06 });
    }

    function buzz() {
      tone({ freq: 220, type: "sawtooth", duration: 0.08, gain: 0.06 });
      tone({ freq: 160, type: "square", duration: 0.08, gain: 0.05, when: 0.06 });
    }

    function chime() {
      const freqs = [523.25, 659.25, 783.99, 1046.5];
      freqs.forEach((f, i) => tone({ freq: f, duration: 0.18, gain: 0.06, when: i * 0.12 }));
    }

    function setActiveDot(n) {
      const g = document.querySelector(`.dot[data-index="${n}"]`);
      if (!g) return;
      if (g.parentNode) g.parentNode.appendChild(g); // Bring to front
      g.classList.add("active");
      const ring = g.querySelector(".ring");
      if (ring) ring.setAttribute("r", "16");
      const hit = g.querySelector(".hit");
      if (hit) hit.setAttribute("r", "32");
    }

    function clearActiveDot() {
      const g = document.querySelector(`.dot.active`);
      if (!g) return;
      g.classList.remove("active");
      const ring = g.querySelector(".ring");
      if (ring) ring.setAttribute("r", "0");
      const hit = g.querySelector(".hit");
      if (hit) hit.setAttribute("r", "25");
    }

    function updateProgress() {
      const total = LEVEL.dots.length;
      const current = Math.min(state.expected, total);
      const el = document.getElementById("progress");
      if (el) el.textContent = `${current} / ${total}`;
    }

    function el(tag, attrs = {}) {
      const node = document.createElementNS("http://www.w3.org/2000/svg", tag);
      Object.entries(attrs).forEach(([k, v]) => node.setAttribute(k, String(v)));
      return node;
    }

    function setBoardTo80vh() {
      const visualH = (window.visualViewport ? window.visualViewport.height : window.innerHeight);
      const H = Math.max(0, visualH) * 0.8;
      const W = window.innerWidth * 0.95;
      const size = Math.min(H, W);
      document.documentElement.style.setProperty("--board-size", size + "px");
    }
  </script>
</body>
</html>

