<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logical Fallacy Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/antijingoist/opendyslexic@1.0.3/build/css/opendyslexic.min.css" type="text/css"/>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* A light, calming blue-gray */
        }
        body.opendyslexic {
            font-family: 'OpenDyslexic', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .tab-button {
            transition: all 0.2s ease-in-out;
        }
        .tab-button.active {
            background-color: #3b82f6; /* A vibrant blue */
            color: white;
        }
        .btn {
            transition: all 0.2s ease-in-out;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #e5e7eb; /* Light gray */
            color: #374151; /* Dark gray text */
        }
        .btn-secondary:hover:not(:disabled) {
            background-color: #d1d5db;
        }
        .feedback {
            transition: opacity 0.3s ease-in-out;
        }
        .correct {
            color: #16a34a; /* Green */
        }
        .incorrect {
            color: #dc2626; /* Red */
        }
        /* Fade-in animation for elements */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        /* Toggle Switch styling */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #68d391;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #68d391;
        }
    </style>
</head>
<body class="antialiased text-slate-800">
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        
        <!-- Accessibility Toggle -->
        <div class="absolute top-4 right-4 flex items-center space-x-2">
            <span class="text-sm font-medium text-slate-600">OpenDyslexic</span>
            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                <input type="checkbox" name="toggle" id="dyslexic-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                <label for="dyslexic-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
            </div>
        </div>

        <!-- Header -->
        <header class="text-center mb-8 pt-8">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900">Logical Fallacy Trainer</h1>
            <p class="mt-2 text-lg text-slate-600">Sharpen your critical thinking skills.</p>
        </header>

        <!-- Mode Switcher -->
        <div class="flex justify-center mb-8 bg-slate-200 rounded-lg p-1 max-w-sm mx-auto">
            <button id="learn-mode-btn" class="tab-button w-1/2 p-2 rounded-md font-semibold active">Learn</button>
            <button id="quiz-mode-btn" class="tab-button w-1/2 p-2 rounded-md font-semibold">Quiz</button>
        </div>

        <!-- Main Content Area -->
        <main id="main-content">
            <!-- Learn Mode -->
            <div id="learn-mode" class="space-y-6">
                 <!-- Fallacy Selector -->
                <div class="card">
                     <label for="fallacy-select" class="block mb-2 text-sm font-medium text-gray-900">Choose a fallacy to study:</label>
                     <select id="fallacy-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                         <!-- Options will be populated by JS -->
                     </select>
                </div>

                <div id="fallacy-display" class="card">
                    <div class="flex flex-col-reverse sm:flex-row justify-between items-start">
                        <div>
                            <h2 id="fallacy-name" class="text-2xl md:text-3xl font-bold text-blue-600 mb-2"></h2>
                            <p id="fallacy-def" class="text-slate-600 mb-4"></p>
                        </div>
                        <div id="fallacy-icon" class="w-16 h-16 sm:w-24 sm:h-24 mb-4 sm:mb-0 sm:ml-6 flex-shrink-0 text-slate-400">
                            <!-- SVG Icon will be injected here -->
                        </div>
                    </div>
                    <h3 class="font-semibold mb-2 text-slate-700">Examples:</h3>
                    <ul id="fallacy-examples" class="list-disc list-inside space-y-2 text-slate-600"></ul>
                </div>

                <div id="scenario-quiz" class="card hidden">
                    <p class="text-slate-600 mb-4">Is the following scenario an example of a <strong id="scenario-fallacy-name" class="font-semibold"></strong>?</p>
                    <p id="scenario-text" class="text-lg font-medium p-4 bg-slate-50 rounded-lg mb-6"></p>
                    <div class="flex justify-center gap-4">
                        <button id="true-btn" class="btn btn-primary w-28">True</button>
                        <button id="false-btn" class="btn btn-primary w-28">False</button>
                    </div>
                    <div id="learn-feedback" class="feedback text-center mt-4 font-semibold text-xl h-6"></div>
                </div>

                <div id="learn-navigation" class="flex justify-between items-center gap-4 pt-4">
                    <button id="prev-fallacy-btn" class="btn btn-secondary">Previous</button>
                    <button id="start-challenge-btn" class="btn btn-primary flex-grow">Start Challenge</button>
                    <button id="review-btn" class="btn btn-secondary hidden">Review Fallacy</button>
                    <button id="next-fallacy-btn" class="btn btn-secondary">Next</button>
                </div>
            </div>

            <!-- Quiz Mode -->
            <div id="quiz-mode" class="hidden">
                <!-- ... (Quiz mode HTML is unchanged) ... -->
                <div id="quiz-setup" class="card text-center">
                    <h2 class="text-2xl font-bold mb-4">Fallacy Quiz</h2>
                    <p class="text-slate-600 mb-6">Select the number of questions you'd like to answer.</p>
                    <div class="flex justify-center gap-4">
                        <button class="btn btn-secondary quiz-length-btn" data-length="5">5 Questions</button>
                        <button class="btn btn-secondary quiz-length-btn" data-length="10">10 Questions</button>
                        <button class="btn btn-secondary quiz-length-btn" data-length="15">15 Questions</button>
                    </div>
                </div>

                <div id="quiz-question-area" class="card hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">Identify the Fallacy</h3>
                        <span id="quiz-progress" class="text-sm font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded"></span>
                    </div>
                    <p id="quiz-question-text" class="text-lg p-4 bg-slate-50 rounded-lg mb-6"></p>
                    <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    <div id="quiz-feedback" class="feedback text-center mt-4 font-semibold text-xl h-6"></div>
                    <div class="text-center mt-6">
                         <button id="next-question-btn" class="btn btn-primary hidden">Next Question</button>
                    </div>
                </div>

                <div id="quiz-results" class="card text-center hidden">
                    <h2 class="text-2xl font-bold mb-2">Quiz Complete!</h2>
                    <p class="text-4xl font-bold my-4" id="quiz-score"></p>
                    <p class="text-slate-600 mb-6" id="quiz-summary-text"></p>
                    <button id="retake-quiz-btn" class="btn btn-primary">Take Another Quiz</button>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        // Data derived from the user-provided CSV file
        const fallaciesData = [
          { "fallacy": "Ad Hominem (including Tu Quoque)", "definition": "Attacking the person making the argument or pointing to their hypocrisy instead of addressing the argumentâ€™s reasoning.", "examples": [ "We shouldn't listen to her argument about climate policy because she didn't even finish high school. â€“ attacks the person's education rather than engaging with the argument.", "Don't listen to Senator Smith's speech about economic reforms; he's been divorced three times. â€“ irrelevant personal details are used to discredit their argument.", "My parents say I shouldn't smoke, but they smoked when they were my age, so their argument is invalid. â€“ a tu quoque response that focuses on hypocrisy instead of the merits of the argument." ] },
          { "fallacy": "Straw Man", "definition": "Misrepresenting or oversimplifying someoneâ€™s argument to make it easier to attack.", "examples": [ "Feminists want to eliminate all differences between men and women; that's ridiculous because people are biologically different. â€“ misrepresents feminist positions to attack them.", "People who support increasing the minimum wage want to give everyone free money without working. â€“ exaggerates opponentsâ€™ stance to make it seem unreasonable.", "Environmentalists care more about trees than people; they would rather let humans die than cut down a tree. â€“ distorts the environmental argument to an extreme version." ] },
          { "fallacy": "Red Herring", "definition": "Introducing an irrelevant issue to distract from the real argument.", "examples": [ "We shouldn't worry about the rising cost of healthcare. The real problem is that people aren't exercising enough. â€“ diverts from healthcare costs to personal fitness.", "When asked about his voting record on environmental issues, the candidate brings up his opponent's personal life. â€“ changes the subject to avoid the question.", "You're complaining about the new office coffee machine, but what about the fact that we got a raise last year? â€“ introduces an unrelated positive point to deflect criticism." ] },
          { "fallacy": "False Dilemma (Either/Or)", "definition": "Presenting only two choices as the only possibilities, when in fact more possibilities exist.", "examples": [ "Either you're with us, or you're against us. â€“ forces a choice between two extremes, ignoring neutral or alternative positions.", "You can either support the new bill or you support crime. â€“ creates a false dichotomy to pressure support for the bill.", "We have to either cut education spending or go into massive debt. â€“ ignores other possibilities like raising taxes or cutting other programs." ] },
          { "fallacy": "Slippery Slope", "definition": "Arguing that a small first step will inevitably lead to a chain of related, negative events.", "examples": [ "If we allow same-sex marriage, then the next thing you know, people will be marrying their pets. â€“ makes an unsupported leap to an extreme outcome.", "If you let a student retake a test, then you'll have to let all students retake all tests, and no one will study. â€“ exaggerates the consequences of a single action.", "If we ban a certain type of weapon, soon the government will take away all our guns. â€“ claims one action will lead to a total loss of rights without evidence." ] },
          { "fallacy": "Hasty Generalization", "definition": "Drawing a broad conclusion based on a small or unrepresentative sample.", "examples": [ "I met two people from that country, and they were both rude. Therefore, everyone from that country is rude. â€“ generalizes from a sample size of two.", "My grandfather smoked his whole life and lived to be 90, so smoking isn't actually bad for you. â€“ uses a single anecdote to dismiss extensive scientific evidence.", "This one article I read online says that climate change is a hoax, so all the scientists must be wrong. â€“ relies on a single source to form a sweeping conclusion." ] },
          { "fallacy": "Appeal to Authority", "definition": "Using the opinion of an authority figure, or an institution of authority, in place of an actual argument, especially when the authority is not an expert in the relevant field.", "examples": [ "A famous actor said this new diet is the best, so it must be true. â€“ relies on a celebrity's endorsement for a health claim.", "My professor said that this politician is corrupt, so he must be. â€“ accepts a claim as true based on an authority figure's opinion, without examining the evidence.", "The government says this is safe, so we have nothing to worry about. â€“ assumes truth based solely on the source's authority." ] },
          { "fallacy": "Circular Reasoning (Begging the Question)", "definition": "An argument where the conclusion is assumed in one of the premises. It's a statement that proves itself.", "examples": [ "The Bible is the word of God because it says so in the Bible. â€“ the premise (the Bible is true) is the same as the conclusion.", "He is a good communicator because he speaks effectively. â€“ 'good communicator' and 'speaks effectively' are the same thing.", "You have to do what I say because I'm the boss. â€“ the authority to be obeyed is based on the position that claims authority." ] },
          { "fallacy": "Equivocation", "definition": "Using a key word in different senses within the same argument, creating ambiguity.", "examples": [ "Feathers are light. What is light cannot be dark. Therefore, feathers cannot be dark. â€“ switches between 'light' meaning weight and brightness.", "The sign said â€˜fine for parking hereâ€™, so parking here is fine. â€“ interprets 'fine' as good instead of a penalty.", "All trees have bark. Every dog barks. So every dog is a tree. â€“ conflates 'bark' as a treeâ€™s covering and a dog's noise." ] },
          { "fallacy": "Appeal to Ignorance", "definition": "Claiming something is true because it hasn't been proven false or vice versa.", "examples": [ "Nobody has proven that aliens don't exist, so they must be out there. â€“ uses lack of disproof as proof.", "There's no evidence that this herbal remedy doesn't work, so it must work. â€“ assumes effectiveness because of absent evidence to the contrary.", "No one has shown that ghosts aren't real; therefore, ghosts exist. â€“ uses absence of evidence as positive evidence." ] },
          { "fallacy": "Appeal to Pity", "definition": "Attempting to persuade by arousing sympathy or pity rather than offering relevant evidence.", "examples": [ "You should give me the job because I'm struggling with rent and need money. â€“ appeals to personal hardship instead of qualifications.", "I deserve a passing grade because I'm going through a tough time, not because of my work. â€“ uses emotional appeal instead of academic performance.", "Please accept my paper even though it's late because my dog is sick and I'm stressed. â€“ attempts to excuse lateness through pity." ] }
        ];

        const fallacyIcons = {
            "Ad Hominem (including Tu Quoque)": `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632zM15 19.5a3 3 0 00-3-3H6a3 3 0 00-3 3v.161a3.756 3.756 0 001.02 2.488" /><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 9.75L15 12m0 0l2.25 2.25M15 12l2.25-2.25M15 12l-2.25 2.25" /></svg>`,
            "Straw Man": `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.284.144A9.094 9.094 0 0112 18.72a9.094 9.094 0 01-5.758-.479m5.758.479L12 21m-2.242-2.28a9.094 9.094 0 01-5.758-.479M12 18.72a9.094 9.094 0 00-3.741-.479m3.741.479c-.022.022-.042.045-.064.067m-3.677-.134l-.064-.067m3.677.134l-.064.067m3.741-.479c-.022.022-.042.045-.064.067m-3.677.134l-.064-.067m3.677.134l-.064-.067m3.741-.479c-.022.022-.042.045-.064.067M3 9.75a3 3 0 013-3h12a3 3 0 013 3v9a3 3 0 01-3 3H6a3 3 0 01-3-3v-9z" /></svg>`,
            "Red Herring": `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
            "False Dilemma (Either/Or)": `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5M3.75 6.75h16.5M3.75 17.25h16.5" /></svg>`,
            "Slippery Slope": `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25L12 21m0 0l-3.75-3.75M12 21V3" /><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
            "Hasty Generalization": `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 15.75l-2.489-2.489m0 0a3.375 3.375 0 10-4.773-4.773 3.375 3.375 0 004.774 4.774zM21 12a9 9 0 11-18 0 9 9 0 0118 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v.01M12 12v.01M12 18v.01M18 12h.01M6 12h.01" /></svg>`,
            "Appeal to Authority": `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
            "Circular Reasoning (Begging the Question)": `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.664 0l3.181-3.183m-4.991-2.696L19.015 7.749M9.348 16.023l-3.181-3.183a8.25 8.25 0 0111.664 0l-3.181 3.183" /></svg>`,
            "Equivocation": `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12s4.03 8.25 9 8.25z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5a4.5 4.5 0 100-9 4.5 4.5 0 000 9z" /></svg>`,
            "Appeal to Ignorance": `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
            "Appeal to Pity": `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.182 16.318A4.5 4.5 0 0012 15a4.5 4.5 0 00-3.182 1.318M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9 9.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75H9.75a.75.75 0 01-.75-.75V9.75zm6 0a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75h-.008a.75.75 0 01-.75-.75V9.75z" /></svg>`
        };

        // DOM Elements
        const learnModeDiv = document.getElementById('learn-mode');
        const quizModeDiv = document.getElementById('quiz-mode');
        const learnModeBtn = document.getElementById('learn-mode-btn');
        const quizModeBtn = document.getElementById('quiz-mode-btn');
        const dyslexicToggle = document.getElementById('dyslexic-toggle');

        // Learn Mode Elements
        const fallacySelect = document.getElementById('fallacy-select');
        const fallacyDisplay = document.getElementById('fallacy-display');
        const fallacyNameEl = document.getElementById('fallacy-name');
        const fallacyIconEl = document.getElementById('fallacy-icon');
        const fallacyDefEl = document.getElementById('fallacy-def');
        const fallacyExamplesEl = document.getElementById('fallacy-examples');
        const scenarioQuizDiv = document.getElementById('scenario-quiz');
        const scenarioTextEl = document.getElementById('scenario-text');
        const scenarioFallacyNameEl = document.getElementById('scenario-fallacy-name');
        const trueBtn = document.getElementById('true-btn');
        const falseBtn = document.getElementById('false-btn');
        const learnFeedbackEl = document.getElementById('learn-feedback');
        const learnNavDiv = document.getElementById('learn-navigation');
        const prevFallacyBtn = document.getElementById('prev-fallacy-btn');
        const nextFallacyBtn = document.getElementById('next-fallacy-btn');
        const reviewBtn = document.getElementById('review-btn');
        const startChallengeBtn = document.getElementById('start-challenge-btn');


        // Quiz Mode Elements
        const quizSetupDiv = document.getElementById('quiz-setup');
        const quizQuestionAreaDiv = document.getElementById('quiz-question-area');
        const quizQuestionTextEl = document.getElementById('quiz-question-text');
        const quizOptionsDiv = document.getElementById('quiz-options');
        const quizProgressEl = document.getElementById('quiz-progress');
        const quizFeedbackEl = document.getElementById('quiz-feedback');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const quizResultsDiv = document.getElementById('quiz-results');
        const quizScoreEl = document.getElementById('quiz-score');
        const quizSummaryTextEl = document.getElementById('quiz-summary-text');
        const retakeQuizBtn = document.getElementById('retake-quiz-btn');

        // State variables
        let currentMode = 'learn';
        let learnState = {
            currentFallacyIndex: 0,
            scenarios: [],
            currentScenarioIndex: 0,
        };
        let quizState = {
            questions: [],
            currentQuestionIndex: 0,
            score: 0,
            length: 0,
        };

        // Utility Functions
        const shuffleArray = (array) => array.slice().sort(() => Math.random() - 0.5);
        const getRandomItem = (array) => array[Math.floor(Math.random() * array.length)];
        
        function switchMode(mode) {
            currentMode = mode;
            if (mode === 'learn') {
                learnModeDiv.style.display = 'block';
                quizModeDiv.style.display = 'none';
                learnModeBtn.classList.add('active');
                quizModeBtn.classList.remove('active');
                initLearnMode();
            } else {
                learnModeDiv.style.display = 'none';
                quizModeDiv.style.display = 'block';
                learnModeBtn.classList.remove('active');
                quizModeBtn.classList.add('active');
                initQuizMode();
            }
        }
        
        // --- LEARN MODE ---
        function populateFallacyDropdown() {
            fallaciesData.forEach((fallacy, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = fallacy.fallacy;
                fallacySelect.appendChild(option);
            });
        }
        
        function initLearnMode() {
            displayFallacy(learnState.currentFallacyIndex);
        }

        function displayFallacy(index) {
            learnState.currentFallacyIndex = parseInt(index);
            const fallacy = fallaciesData[learnState.currentFallacyIndex];

            fallacyNameEl.textContent = fallacy.fallacy;
            fallacyDefEl.textContent = fallacy.definition;
            fallacyIconEl.innerHTML = fallacyIcons[fallacy.fallacy] || '';
            fallacyExamplesEl.innerHTML = fallacy.examples.map(ex => `<li>${ex}</li>`).join('');
            
            fallacySelect.value = learnState.currentFallacyIndex;
            
            // Update nav buttons
            prevFallacyBtn.disabled = learnState.currentFallacyIndex === 0;
            nextFallacyBtn.disabled = learnState.currentFallacyIndex === fallaciesData.length - 1;

            // Reset view
            fallacyDisplay.classList.remove('hidden');
            scenarioQuizDiv.classList.add('hidden');
            learnNavDiv.classList.remove('hidden');
            startChallengeBtn.classList.remove('hidden');
            reviewBtn.classList.add('hidden');
            prevFallacyBtn.classList.remove('hidden');
            nextFallacyBtn.classList.remove('hidden');


            fallacyDisplay.classList.remove('fade-in');
            void fallacyDisplay.offsetWidth; // Trigger reflow
            fallacyDisplay.classList.add('fade-in');
        }

        function startLearnChallenge() {
            learnState.currentScenarioIndex = 0;
            generateLearnScenarios();
            displayLearnScenario();
            fallacyDisplay.classList.add('hidden');
            learnNavDiv.classList.add('hidden');
            scenarioQuizDiv.classList.remove('hidden');
            scenarioQuizDiv.classList.remove('fade-in');
            void scenarioQuizDiv.offsetWidth;
            scenarioQuizDiv.classList.add('fade-in');
        }

        function generateLearnScenarios() {
            const currentFallacy = fallaciesData[learnState.currentFallacyIndex];
            const otherFallacies = fallaciesData.filter((_, i) => i !== learnState.currentFallacyIndex);
            
            learnState.scenarios = [];
            // Add one true example
            learnState.scenarios.push({ text: getRandomItem(currentFallacy.examples), isCorrectFallacy: true });

            // Add two false examples
            const falseFallacies = shuffleArray(otherFallacies).slice(0, 2);
            falseFallacies.forEach(fallacy => {
                learnState.scenarios.push({ text: getRandomItem(fallacy.examples), isCorrectFallacy: false });
            });

            learnState.scenarios = shuffleArray(learnState.scenarios);
        }

        function displayLearnScenario() {
            const scenario = learnState.scenarios[learnState.currentScenarioIndex];
            const currentFallacyName = fallaciesData[learnState.currentFallacyIndex].fallacy;
            
            scenarioFallacyNameEl.textContent = currentFallacyName;
            scenarioTextEl.textContent = scenario.text;
            learnFeedbackEl.textContent = '';
            trueBtn.disabled = false;
            falseBtn.disabled = false;
        }

        function handleLearnAnswer(userAnswer) {
            trueBtn.disabled = true;
            falseBtn.disabled = true;
            const correct = learnState.scenarios[learnState.currentScenarioIndex].isCorrectFallacy;

            if (userAnswer === correct) {
                learnFeedbackEl.textContent = 'Correct!';
                learnFeedbackEl.className = 'feedback text-center mt-4 font-semibold text-xl h-6 correct';
            } else {
                learnFeedbackEl.textContent = 'Incorrect.';
                learnFeedbackEl.className = 'feedback text-center mt-4 font-semibold text-xl h-6 incorrect';
            }

            setTimeout(() => {
                learnState.currentScenarioIndex++;
                if (learnState.currentScenarioIndex < learnState.scenarios.length) {
                    displayLearnScenario();
                } else {
                    endLearnChallenge();
                }
            }, 1500);
        }

        function endLearnChallenge() {
            scenarioQuizDiv.classList.add('hidden');
            learnNavDiv.classList.remove('hidden');
            startChallengeBtn.classList.add('hidden');
            reviewBtn.classList.remove('hidden');
            prevFallacyBtn.classList.add('hidden');
            nextFallacyBtn.classList.add('hidden');
        }


        // --- QUIZ MODE ---
        function initQuizMode() {
            quizSetupDiv.classList.remove('hidden');
            quizQuestionAreaDiv.classList.add('hidden');
            quizResultsDiv.classList.add('hidden');
        }

        function startQuiz(length) {
            quizState.length = length;
            quizState.score = 0;
            quizState.currentQuestionIndex = 0;
            generateQuizQuestions(length);
            quizSetupDiv.classList.add('hidden');
            quizQuestionAreaDiv.classList.remove('hidden');
            quizQuestionAreaDiv.classList.remove('fade-in');
            void quizQuestionAreaDiv.offsetWidth;
            quizQuestionAreaDiv.classList.add('fade-in');
            displayQuizQuestion();
        }

        function generateQuizQuestions(numQuestions) {
            const allExamples = fallaciesData.flatMap(f => f.examples.map(ex => ({ text: ex, correctFallacy: f.fallacy })));
            const shuffledExamples = shuffleArray(allExamples).slice(0, numQuestions);
            
            quizState.questions = shuffledExamples.map(q => {
                const distractors = shuffleArray(fallaciesData.filter(f => f.fallacy !== q.correctFallacy))
                    .slice(0, 3)
                    .map(f => f.fallacy);
                const options = shuffleArray([q.correctFallacy, ...distractors]);
                return { ...q, options };
            });
        }

        function displayQuizQuestion() {
            const q = quizState.questions[quizState.currentQuestionIndex];
            quizQuestionTextEl.textContent = q.text;
            quizProgressEl.textContent = `Question ${quizState.currentQuestionIndex + 1} of ${quizState.length}`;
            quizOptionsDiv.innerHTML = '';
            q.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'btn btn-secondary text-left';
                button.onclick = () => handleQuizAnswer(option);
                quizOptionsDiv.appendChild(button);
            });
            quizFeedbackEl.textContent = '';
            nextQuestionBtn.classList.add('hidden');
        }

        function handleQuizAnswer(selectedOption) {
            const correct = quizState.questions[quizState.currentQuestionIndex].correctFallacy;
            const buttons = quizOptionsDiv.querySelectorAll('button');
            buttons.forEach(b => {
                b.disabled = true;
                if (b.textContent === correct) {
                    b.classList.add('!bg-green-500', '!text-white');
                } else if (b.textContent === selectedOption) {
                    b.classList.add('!bg-red-500', '!text-white');
                }
            });

            if (selectedOption === correct) {
                quizState.score++;
                quizFeedbackEl.textContent = 'Correct!';
                quizFeedbackEl.className = 'feedback text-center mt-4 font-semibold text-xl h-6 correct';
            } else {
                quizFeedbackEl.textContent = 'Incorrect.';
                quizFeedbackEl.className = 'feedback text-center mt-4 font-semibold text-xl h-6 incorrect';
            }
            nextQuestionBtn.classList.remove('hidden');
        }

        function nextQuizQuestion() {
            quizState.currentQuestionIndex++;
            if (quizState.currentQuestionIndex < quizState.length) {
                displayQuizQuestion();
            } else {
                showQuizResults();
            }
        }

        function showQuizResults() {
            quizQuestionAreaDiv.classList.add('hidden');
            quizResultsDiv.classList.remove('hidden');
            quizScoreEl.textContent = `${quizState.score} / ${quizState.length}`;
            const percentage = (quizState.score / quizState.length) * 100;
            let summary = "Keep practicing!";
            if (percentage > 90) summary = "Excellent work!";
            else if (percentage > 70) summary = "Great job!";
            else if (percentage > 50) summary = "Good effort!";
            quizSummaryTextEl.textContent = summary;
            quizResultsDiv.classList.remove('fade-in');
            void quizResultsDiv.offsetWidth;
            quizResultsDiv.classList.add('fade-in');
        }


        // Event Listeners
        learnModeBtn.addEventListener('click', () => switchMode('learn'));
        quizModeBtn.addEventListener('click', () => switchMode('quiz'));
        dyslexicToggle.addEventListener('change', () => {
            document.body.classList.toggle('opendyslexic');
        });

        // Learn Mode Listeners
        fallacySelect.addEventListener('change', (e) => displayFallacy(e.target.value));
        prevFallacyBtn.addEventListener('click', () => displayFallacy(learnState.currentFallacyIndex - 1));
        nextFallacyBtn.addEventListener('click', () => displayFallacy(learnState.currentFallacyIndex + 1));
        startChallengeBtn.addEventListener('click', startLearnChallenge);
        reviewBtn.addEventListener('click', () => displayFallacy(learnState.currentFallacyIndex));
        trueBtn.addEventListener('click', () => handleLearnAnswer(true));
        falseBtn.addEventListener('click', () => handleLearnAnswer(false));
        
        // Quiz Mode Listeners
        document.querySelectorAll('.quiz-length-btn').forEach(btn => {
            btn.addEventListener('click', () => startQuiz(parseInt(btn.dataset.length)));
        });
        nextQuestionBtn.addEventListener('click', nextQuizQuestion);
        retakeQuizBtn.addEventListener('click', initQuizMode);
        
        // Initial setup
        populateFallacyDropdown();
        switchMode('learn');
    </script>
</body>
</html>


