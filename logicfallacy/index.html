<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logical Fallacy & Argument Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/antijingoist/opendyslexic@1.0.3/build/css/opendyslexic.min.css" type="text/css"/>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* A light, calming blue-gray */
        }
        body.opendyslexic {
            font-family: 'OpenDyslexic', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .tab-button, .topic-button {
            transition: all 0.2s ease-in-out;
        }
        .tab-button.active, .topic-button.active {
            background-color: #3b82f6; /* A vibrant blue */
            color: white;
        }
        .btn {
            transition: all 0.2s ease-in-out;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #e5e7eb; /* Light gray */
            color: #374151; /* Dark gray text */
        }
        .btn-secondary:hover:not(:disabled) {
            background-color: #d1d5db;
        }
        .feedback {
            transition: opacity 0.3s ease-in-out;
        }
        .correct {
            color: #16a34a; /* Green */
        }
        .incorrect {
            color: #dc2626; /* Red */
        }
        /* Fade-in animation for elements */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        /* Toggle Switch styling */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #68d391;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #68d391;
        }
    </style>
</head>
<body class="antialiased text-slate-800">
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        
        <!-- Accessibility Toggle -->
        <div class="absolute top-4 right-4 flex items-center space-x-2">
            <span class="text-sm font-medium text-slate-600">OpenDyslexic</span>
            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                <input type="checkbox" name="toggle" id="dyslexic-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                <label for="dyslexic-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
            </div>
        </div>

        <!-- Header -->
        <header class="text-center mb-8 pt-8">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900">Argument & Fallacy Trainer</h1>
            <p class="mt-2 text-lg text-slate-600">Sharpen your critical thinking skills.</p>
        </header>

        <!-- Topic Selector -->
        <div class="text-center mb-6">
            <h2 class="text-xl font-semibold mb-3">What would you like to study?</h2>
            <div class="flex justify-center bg-slate-200 rounded-lg p-1 max-w-md mx-auto">
                <button id="topic-fallacies-btn" class="topic-button w-1/2 p-2 rounded-md font-semibold active">Logical Fallacies</button>
                <button id="topic-structure-btn" class="topic-button w-1/2 p-2 rounded-md font-semibold">Argument Structure</button>
            </div>
        </div>


        <!-- Mode Switcher -->
        <div class="flex justify-center mb-8 bg-slate-200 rounded-lg p-1 max-w-sm mx-auto">
            <button id="learn-mode-btn" class="tab-button w-1/2 p-2 rounded-md font-semibold active">Learn</button>
            <button id="quiz-mode-btn" class="tab-button w-1/2 p-2 rounded-md font-semibold">Quiz</button>
        </div>

        <!-- Main Content Area -->
        <main id="main-content">
            <!-- Learn Mode -->
            <div id="learn-mode" class="space-y-6">
                 <!-- Concept Selector -->
                <div class="card">
                     <label for="concept-select" class="block mb-2 text-sm font-medium text-gray-900">Choose a concept to study:</label>
                     <select id="concept-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                         <!-- Options will be populated by JS -->
                     </select>
                </div>

                <div id="concept-display" class="card">
                    <h2 id="concept-name" class="text-2xl md:text-3xl font-bold text-blue-600 mb-2"></h2>
                    <p id="concept-def" class="text-slate-600 mb-4"></p>
                    <h3 class="font-semibold mb-2 text-slate-700">Examples:</h3>
                    <ul id="concept-examples" class="list-disc list-inside space-y-2 text-slate-600"></ul>
                </div>

                <div id="scenario-quiz" class="card hidden">
                    <p class="text-slate-600 mb-4">Is the following scenario an example of a <strong id="scenario-concept-name" class="font-semibold"></strong>?</p>
                    <p id="scenario-text" class="text-lg font-medium p-4 bg-slate-50 rounded-lg mb-6"></p>
                    <div class="flex justify-center gap-4">
                        <button id="true-btn" class="btn btn-primary w-28">True</button>
                        <button id="false-btn" class="btn btn-primary w-28">False</button>
                    </div>
                    <div id="learn-feedback" class="feedback text-center mt-4 font-semibold text-xl h-6"></div>
                </div>

                <div id="learn-navigation" class="flex justify-between items-center gap-4 pt-4">
                    <button id="prev-concept-btn" class="btn btn-secondary">Previous</button>
                    <button id="start-challenge-btn" class="btn btn-primary flex-grow">Start Challenge</button>
                    <button id="review-btn" class="btn btn-secondary hidden">Review Concept</button>
                    <button id="next-concept-btn" class="btn btn-secondary">Next</button>
                </div>
            </div>

            <!-- Quiz Mode -->
            <div id="quiz-mode" class="hidden">
                <div id="quiz-setup" class="card text-center">
                    <h2 class="text-2xl font-bold mb-4">Comprehensive Quiz</h2>
                    <p class="text-slate-600 mb-6">This quiz includes questions on both Logical Fallacies and Argument Structure. Select the number of questions you'd like to answer.</p>
                    <div class="flex justify-center gap-4">
                        <button class="btn btn-secondary quiz-length-btn" data-length="5">5 Questions</button>
                        <button class="btn btn-secondary quiz-length-btn" data-length="10">10 Questions</button>
                        <button class="btn btn-secondary quiz-length-btn" data-length="15">15 Questions</button>
                    </div>
                </div>
                <div id="quiz-question-area" class="card hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">Identify the Concept</h3>
                        <span id="quiz-progress" class="text-sm font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded"></span>
                    </div>
                    <p id="quiz-question-text" class="text-lg p-4 bg-slate-50 rounded-lg mb-6"></p>
                    <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    <div id="quiz-feedback" class="feedback text-center mt-4 font-semibold text-xl h-6"></div>
                    <div class="text-center mt-6">
                         <button id="next-question-btn" class="btn btn-primary hidden">Next Question</button>
                    </div>
                </div>
                <div id="quiz-results" class="card text-center hidden">
                    <h2 class="text-2xl font-bold mb-2">Quiz Complete!</h2>
                    <p class="text-4xl font-bold my-4" id="quiz-score"></p>
                    <p class="text-slate-600 mb-6" id="quiz-summary-text"></p>
                    <button id="retake-quiz-btn" class="btn btn-primary">Take Another Quiz</button>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        const fallaciesData = [
          { "concept": "Ad Hominem (including Tu Quoque)", "definition": "Attacking the person making the argument or pointing to their hypocrisy instead of addressing the argument’s reasoning.", "examples": [ "We shouldn't listen to her argument about climate policy because she didn't even finish high school.", "Don't listen to Senator Smith's speech about economic reforms; he's been divorced three times.", "My parents say I shouldn't smoke, but they smoked when they were my age, so their argument is invalid." ] },
          { "concept": "Straw Man", "definition": "Misrepresenting or oversimplifying someone’s argument to make it easier to attack.", "examples": [ "Feminists want to eliminate all differences between men and women; that's ridiculous because people are biologically different.", "People who support increasing the minimum wage want to give everyone free money without working.", "Environmentalists care more about trees than people; they would rather let humans die than cut down a tree." ] },
          { "concept": "Red Herring", "definition": "Introducing an irrelevant issue to distract from the real argument.", "examples": [ "We shouldn't worry about the rising cost of healthcare. The real problem is that people aren't exercising enough.", "When asked about his voting record on environmental issues, the candidate brings up his opponent's personal life.", "You're complaining about the new office coffee machine, but what about the fact that we got a raise last year?" ] },
          { "concept": "False Dilemma (Either/Or)", "definition": "Presenting only two choices as the only possibilities, when in fact more possibilities exist.", "examples": [ "Either you're with us, or you're against us.", "You can either support the new bill or you support crime.", "We have to either cut education spending or go into massive debt." ] },
          { "concept": "Slippery Slope", "definition": "Arguing that a small first step will inevitably lead to a chain of related, negative events.", "examples": [ "If we allow same-sex marriage, then the next thing you know, people will be marrying their pets.", "If you let a student retake a test, then you'll have to let all students retake all tests, and no one will study.", "If we ban a certain type of weapon, soon the government will take away all our guns." ] },
          { "concept": "Hasty Generalization", "definition": "Drawing a broad conclusion based on a small or unrepresentative sample.", "examples": [ "I met two people from that country, and they were both rude. Therefore, everyone from that country is rude.", "My grandfather smoked his whole life and lived to be 90, so smoking isn't actually bad for you.", "This one article I read online says that climate change is a hoax, so all the scientists must be wrong." ] },
          { "concept": "Appeal to Authority", "definition": "Using the opinion of an authority figure, or an institution of authority, in place of an actual argument, especially when the authority is not an expert in the relevant field.", "examples": [ "A famous actor said this new diet is the best, so it must be true.", "My professor said that this politician is corrupt, so he must be.", "The government says this is safe, so we have nothing to worry about." ] },
          { "concept": "Circular Reasoning (Begging the Question)", "definition": "An argument where the conclusion is assumed in one of the premises. It's a statement that proves itself.", "examples": [ "The Bible is the word of God because it says so in the Bible.", "He is a good communicator because he speaks effectively.", "You have to do what I say because I'm the boss." ] },
          { "concept": "Equivocation", "definition": "Using a key word in different senses within the same argument, creating ambiguity.", "examples": [ "Feathers are light. What is light cannot be dark. Therefore, feathers cannot be dark.", "The sign said ‘fine for parking here’, so parking here is fine.", "All trees have bark. Every dog barks. So every dog is a tree." ] },
          { "concept": "Appeal to Ignorance", "definition": "Claiming something is true because it hasn't been proven false or vice versa.", "examples": [ "Nobody has proven that aliens don't exist, so they must be out there.", "There's no evidence that this herbal remedy doesn't work, so it must work.", "No one has shown that ghosts aren't real; therefore, ghosts exist." ] },
          { "concept": "Appeal to Pity", "definition": "Attempting to persuade by arousing sympathy or pity rather than offering relevant evidence.", "examples": [ "You should give me the job because I'm struggling with rent and need money.", "I deserve a passing grade because I'm going through a tough time, not because of my work.", "Please accept my paper even though it's late because my dog is sick and I'm stressed." ] }
        ];

        const structureData = [
            { "concept": "Identify Premises and Conclusion", "definition": "An argument consists of premises (reasons) offered to support a conclusion; to evaluate it, first identify these parts. A conclusion is the statement the author wants us to accept, and premises provide evidence or reasons.", "examples": [ "A letter to the editor lists reasons for closing a park, such as safety concerns and maintenance costs, but never explicitly states the conclusion. To understand the argument, ask: “Is the writer arguing to close the park or to call for better policing?”", "Someone asserts, “All athletes are dedicated; Ana is dedicated; therefore, Ana is an athlete.” By identifying the conclusion (Ana is an athlete) and premises (All athletes are dedicated; Ana is dedicated), you can see that the argument’s structure is flawed.", "In a speech, a candidate lists promises such as improving schools and lowering taxes, then says “Therefore, vote for me.”" ]},
            { "concept": "Evaluate the Connection between Premises and Conclusion", "definition": "Once you identify the premises and conclusion, you must determine whether the premises actually support the conclusion. Ask yourself: if the premises are true, do they provide good reason to accept the conclusion?", "examples": [ "The premise that a company’s profits have increased does not, by itself, justify the conclusion that its employees are well-paid. The connection is weak without additional information.", "If someone argues, “All dogs are mammals, and Fido is a dog, so Fido is a mammal,” the premises strongly support the conclusion.", "An advertisement claims a new car is safe because it has a premium sound system. The premise (good sound system) is irrelevant to the conclusion (safety)." ]},
            { "concept": "Consider Alternative Explanations", "definition": "When an argument presents a cause-and-effect relationship or an interpretation of evidence, it’s important to ask whether other explanations could also account for the evidence. This helps determine the argument’s strength.", "examples": [ "In a criminal trial, evidence seems to point to one suspect. To evaluate the inference, consider alternative suspects or motives before concluding guilt.", "After observing a correlation between violent video games and aggression, ask whether socioeconomic status, upbringing, or stress could be alternative explanations.", "A student blames poor grades on the teacher’s bias. Consider whether factors like study habits or attendance might also explain the outcome." ]},
            { "concept": "Recognizing Bias and Perspective", "definition": "Arguments often reflect the point of view or bias of the speaker. Identifying the perspective helps you weigh the evidence and decide how much weight to give it.", "examples": [ "A news outlet with a political slant reports an event selectively. Being aware of the outlet’s bias prompts you to seek alternative sources for a balanced understanding.", "A product review written by the manufacturer is likely biased. Recognizing this encourages you to look for independent reviews before purchasing.", "A friend’s enthusiastic recommendation of a film may stem from their admiration of the lead actor. By considering this bias, you can adjust your expectations accordingly." ]}
        ];

        // DOM Elements
        const learnModeDiv = document.getElementById('learn-mode');
        const quizModeDiv = document.getElementById('quiz-mode');
        const learnModeBtn = document.getElementById('learn-mode-btn');
        const quizModeBtn = document.getElementById('quiz-mode-btn');
        const dyslexicToggle = document.getElementById('dyslexic-toggle');
        const topicFallaciesBtn = document.getElementById('topic-fallacies-btn');
        const topicStructureBtn = document.getElementById('topic-structure-btn');

        // Learn Mode Elements
        const conceptSelect = document.getElementById('concept-select');
        const conceptDisplay = document.getElementById('concept-display');
        const conceptNameEl = document.getElementById('concept-name');
        const conceptDefEl = document.getElementById('concept-def');
        const conceptExamplesEl = document.getElementById('concept-examples');
        const scenarioQuizDiv = document.getElementById('scenario-quiz');
        const scenarioTextEl = document.getElementById('scenario-text');
        const scenarioConceptNameEl = document.getElementById('scenario-concept-name');
        const trueBtn = document.getElementById('true-btn');
        const falseBtn = document.getElementById('false-btn');
        const learnFeedbackEl = document.getElementById('learn-feedback');
        const learnNavDiv = document.getElementById('learn-navigation');
        const prevConceptBtn = document.getElementById('prev-concept-btn');
        const nextConceptBtn = document.getElementById('next-concept-btn');
        const reviewBtn = document.getElementById('review-btn');
        const startChallengeBtn = document.getElementById('start-challenge-btn');


        // Quiz Mode Elements
        const quizSetupDiv = document.getElementById('quiz-setup');
        const quizQuestionAreaDiv = document.getElementById('quiz-question-area');
        const quizQuestionTextEl = document.getElementById('quiz-question-text');
        const quizOptionsDiv = document.getElementById('quiz-options');
        const quizProgressEl = document.getElementById('quiz-progress');
        const quizFeedbackEl = document.getElementById('quiz-feedback');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const quizResultsDiv = document.getElementById('quiz-results');
        const quizScoreEl = document.getElementById('quiz-score');
        const quizSummaryTextEl = document.getElementById('quiz-summary-text');
        const retakeQuizBtn = document.getElementById('retake-quiz-btn');

        // State variables
        let currentMode = 'learn';
        let currentTopic = 'fallacies';
        let learnState = {
            currentConceptIndex: 0,
            scenarios: [],
            currentScenarioIndex: 0,
        };
        let quizState = {
            questions: [],
            currentQuestionIndex: 0,
            score: 0,
            length: 0,
        };

        // Utility Functions
        const shuffleArray = (array) => array.slice().sort(() => Math.random() - 0.5);
        const getRandomItem = (array) => array[Math.floor(Math.random() * array.length)];
        
        function switchTopic(topic) {
            currentTopic = topic;
            if (topic === 'fallacies') {
                topicFallaciesBtn.classList.add('active');
                topicStructureBtn.classList.remove('active');
            } else {
                topicFallaciesBtn.classList.remove('active');
                topicStructureBtn.classList.add('active');
            }
            // Re-initialize the current mode with the new topic
            switchMode(currentMode);
        }
        
        function switchMode(mode) {
            currentMode = mode;
            if (mode === 'learn') {
                learnModeDiv.style.display = 'block';
                quizModeDiv.style.display = 'none';
                learnModeBtn.classList.add('active');
                quizModeBtn.classList.remove('active');
                initLearnMode();
            } else {
                learnModeDiv.style.display = 'none';
                quizModeDiv.style.display = 'block';
                learnModeBtn.classList.remove('active');
                quizModeBtn.classList.add('active');
                initQuizMode();
            }
        }
        
        // --- LEARN MODE ---
        function populateConceptDropdown() {
            const data = currentTopic === 'fallacies' ? fallaciesData : structureData;
            conceptSelect.innerHTML = '';
            data.forEach((item, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = item.concept;
                conceptSelect.appendChild(option);
            });
        }
        
        function initLearnMode() {
            learnState.currentConceptIndex = 0;
            populateConceptDropdown();
            displayLearnItem(0);
        }

        function displayLearnItem(index) {
            learnState.currentConceptIndex = parseInt(index);
            const data = currentTopic === 'fallacies' ? fallaciesData : structureData;
            const item = data[learnState.currentConceptIndex];

            conceptNameEl.textContent = item.concept;
            conceptDefEl.textContent = item.definition;
            conceptExamplesEl.innerHTML = item.examples.map(ex => `<li>${ex}</li>`).join('');
            
            conceptSelect.value = learnState.currentConceptIndex;
            
            prevConceptBtn.disabled = learnState.currentConceptIndex === 0;
            nextConceptBtn.disabled = learnState.currentConceptIndex === data.length - 1;

            conceptDisplay.classList.remove('hidden');
            scenarioQuizDiv.classList.add('hidden');
            learnNavDiv.classList.remove('hidden');
            startChallengeBtn.classList.remove('hidden');
            reviewBtn.classList.add('hidden');
            prevConceptBtn.classList.remove('hidden');
            nextConceptBtn.classList.remove('hidden');


            conceptDisplay.classList.remove('fade-in');
            void conceptDisplay.offsetWidth; // Trigger reflow
            conceptDisplay.classList.add('fade-in');
        }

        function startLearnChallenge() {
            learnState.currentScenarioIndex = 0;
            generateLearnScenarios();
            displayLearnScenario();
            conceptDisplay.classList.add('hidden');
            learnNavDiv.classList.add('hidden');
            scenarioQuizDiv.classList.remove('hidden');
            scenarioQuizDiv.classList.remove('fade-in');
            void scenarioQuizDiv.offsetWidth;
            scenarioQuizDiv.classList.add('fade-in');
        }

        function generateLearnScenarios() {
            const dataPool = currentTopic === 'fallacies' ? fallaciesData : structureData;
            const currentConcept = dataPool[learnState.currentConceptIndex];
            const otherConcepts = dataPool.filter((_, i) => i !== learnState.currentConceptIndex);
            
            learnState.scenarios = [];
            learnState.scenarios.push({ text: getRandomItem(currentConcept.examples), isCorrectConcept: true });

            const falseConcepts = shuffleArray(otherConcepts).slice(0, 2);
            falseConcepts.forEach(concept => {
                learnState.scenarios.push({ text: getRandomItem(concept.examples), isCorrectConcept: false });
            });

            learnState.scenarios = shuffleArray(learnState.scenarios);
        }

        function displayLearnScenario() {
            const scenario = learnState.scenarios[learnState.currentScenarioIndex];
            const dataPool = currentTopic === 'fallacies' ? fallaciesData : structureData;
            const currentConceptName = dataPool[learnState.currentConceptIndex].concept;
            
            scenarioConceptNameEl.textContent = currentConceptName;
            scenarioTextEl.textContent = scenario.text;
            learnFeedbackEl.textContent = '';
            trueBtn.disabled = false;
            falseBtn.disabled = false;
        }

        function handleLearnAnswer(userAnswer) {
            trueBtn.disabled = true;
            falseBtn.disabled = true;
            const correct = learnState.scenarios[learnState.currentScenarioIndex].isCorrectConcept;

            if (userAnswer === correct) {
                learnFeedbackEl.textContent = 'Correct!';
                learnFeedbackEl.className = 'feedback text-center mt-4 font-semibold text-xl h-6 correct';
            } else {
                learnFeedbackEl.textContent = 'Incorrect.';
                learnFeedbackEl.className = 'feedback text-center mt-4 font-semibold text-xl h-6 incorrect';
            }

            setTimeout(() => {
                learnState.currentScenarioIndex++;
                if (learnState.currentScenarioIndex < learnState.scenarios.length) {
                    displayLearnScenario();
                } else {
                    endLearnChallenge();
                }
            }, 1500);
        }

        function endLearnChallenge() {
            scenarioQuizDiv.classList.add('hidden');
            learnNavDiv.classList.remove('hidden');
            startChallengeBtn.classList.add('hidden');
            reviewBtn.classList.remove('hidden');
            prevConceptBtn.classList.add('hidden');
            nextConceptBtn.classList.add('hidden');
        }


        // --- QUIZ MODE ---
        function initQuizMode() {
            quizSetupDiv.classList.remove('hidden');
            quizQuestionAreaDiv.classList.add('hidden');
            quizResultsDiv.classList.add('hidden');
        }

        function startQuiz(length) {
            quizState.length = length;
            quizState.score = 0;
            quizState.currentQuestionIndex = 0;
            generateQuizQuestions(length);
            quizSetupDiv.classList.add('hidden');
            quizQuestionAreaDiv.classList.remove('hidden');
            quizQuestionAreaDiv.classList.remove('fade-in');
            void quizQuestionAreaDiv.offsetWidth;
            quizQuestionAreaDiv.classList.add('fade-in');
            displayQuizQuestion();
        }

        function generateQuizQuestions(numQuestions) {
            const combinedData = [...fallaciesData, ...structureData];
            const allExamples = combinedData.flatMap(item => item.examples.map(ex => ({ text: ex, correctConcept: item.concept })));
            const shuffledExamples = shuffleArray(allExamples).slice(0, numQuestions);
            
            quizState.questions = shuffledExamples.map(q => {
                const distractors = shuffleArray(combinedData.filter(item => item.concept !== q.correctConcept))
                    .slice(0, 3)
                    .map(item => item.concept);
                const options = shuffleArray([q.correctConcept, ...distractors]);
                return { ...q, options };
            });
        }

        function displayQuizQuestion() {
            const q = quizState.questions[quizState.currentQuestionIndex];
            quizQuestionTextEl.textContent = q.text;
            quizProgressEl.textContent = `Question ${quizState.currentQuestionIndex + 1} of ${quizState.length}`;
            quizOptionsDiv.innerHTML = '';
            q.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'btn btn-secondary text-left';
                button.onclick = () => handleQuizAnswer(option);
                quizOptionsDiv.appendChild(button);
            });
            quizFeedbackEl.textContent = '';
            nextQuestionBtn.classList.add('hidden');
        }

        function handleQuizAnswer(selectedOption) {
            const correct = quizState.questions[quizState.currentQuestionIndex].correctConcept;
            const buttons = quizOptionsDiv.querySelectorAll('button');
            buttons.forEach(b => {
                b.disabled = true;
                if (b.textContent === correct) {
                    b.classList.add('!bg-green-500', '!text-white');
                } else if (b.textContent === selectedOption) {
                    b.classList.add('!bg-red-500', '!text-white');
                }
            });

            if (selectedOption === correct) {
                quizState.score++;
                quizFeedbackEl.textContent = 'Correct!';
                quizFeedbackEl.className = 'feedback text-center mt-4 font-semibold text-xl h-6 correct';
            } else {
                quizFeedbackEl.textContent = 'Incorrect.';
                quizFeedbackEl.className = 'feedback text-center mt-4 font-semibold text-xl h-6 incorrect';
            }
            nextQuestionBtn.classList.remove('hidden');
        }

        function nextQuizQuestion() {
            quizState.currentQuestionIndex++;
            if (quizState.currentQuestionIndex < quizState.length) {
                displayQuizQuestion();
            } else {
                showQuizResults();
            }
        }

        function showQuizResults() {
            quizQuestionAreaDiv.classList.add('hidden');
            quizResultsDiv.classList.remove('hidden');
            quizScoreEl.textContent = `${quizState.score} / ${quizState.length}`;
            const percentage = (quizState.score / quizState.length) * 100;
            let summary = "Keep practicing!";
            if (percentage >= 90) summary = "Excellent work!";
            else if (percentage >= 70) summary = "Great job!";
            else if (percentage >= 50) summary = "Good effort!";
            quizSummaryTextEl.textContent = summary;
            quizResultsDiv.classList.remove('fade-in');
            void quizResultsDiv.offsetWidth;
            quizResultsDiv.classList.add('fade-in');
        }


        // Event Listeners
        topicFallaciesBtn.addEventListener('click', () => switchTopic('fallacies'));
        topicStructureBtn.addEventListener('click', () => switchTopic('structure'));
        learnModeBtn.addEventListener('click', () => switchMode('learn'));
        quizModeBtn.addEventListener('click', () => switchMode('quiz'));
        dyslexicToggle.addEventListener('change', () => {
            document.body.classList.toggle('opendyslexic');
        });

        // Learn Mode Listeners
        conceptSelect.addEventListener('change', (e) => displayLearnItem(e.target.value));
        prevConceptBtn.addEventListener('click', () => displayLearnItem(learnState.currentConceptIndex - 1));
        nextConceptBtn.addEventListener('click', () => displayLearnItem(learnState.currentConceptIndex + 1));
        startChallengeBtn.addEventListener('click', startLearnChallenge);
        reviewBtn.addEventListener('click', () => displayLearnItem(learnState.currentConceptIndex));
        trueBtn.addEventListener('click', () => handleLearnAnswer(true));
        falseBtn.addEventListener('click', () => handleLearnAnswer(false));
        
        // Quiz Mode Listeners
        document.querySelectorAll('.quiz-length-btn').forEach(btn => {
            btn.addEventListener('click', () => startQuiz(parseInt(btn.dataset.length)));
        });
        nextQuestionBtn.addEventListener('click', nextQuizQuestion);
        retakeQuizBtn.addEventListener('click', initQuizMode);
        
        // Initial setup
        switchTopic('fallacies');
    </script>
</body>
</html>

